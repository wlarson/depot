<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'><head><title>/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/date_helper.rb - C0 code coverage information</title>
    <style type='text/css'>body { background-color: rgb(240, 240, 245); }</style>
    <style type='text/css'>span.cross-ref-title {
 font-size: 140%;
}
span.cross-ref a {
 text-decoration: none;
}
span.cross-ref {
 background-color:#f3f7fa;
 border: 1px dashed #333;
 margin: 1em;
 padding: 0.5em;
 overflow: hidden;
}
a.crossref-toggle {
 text-decoration: none;
}
span.marked0 {
 background-color: rgb(185, 210, 200);
 display: block;
}
span.marked1 {
 background-color: rgb(190, 215, 205);
 display: block;
}
span.inferred0 {
 background-color: rgb(175, 200, 200);
 display: block;
}
span.inferred1 {
 background-color: rgb(180, 205, 205);
 display: block;
}
span.uncovered0 {
 background-color: rgb(225, 110, 110);
 display: block;
}
span.uncovered1 {
 background-color: rgb(235, 120, 120);
 display: block;
}
span.overview {
 border-bottom: 8px solid black;
}
div.overview {
 border-bottom: 8px solid black;
}
body {
 font-family: verdana, arial, helvetica;
}
div.footer {
 font-size: 68%;
 margin-top: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
 margin-bottom: 0.5em;
}
h5 {
 margin-top: 0.5em;
}
.hidden {
 display: none;
}
div.separator {
 height: 10px;
}
/* Commented out for better readability, esp. on IE */
/*
table tr td, table tr th {
 font-size: 68%;
}
td.value table tr td {
 font-size: 11px;
}
*/
table.percent_graph {
 height: 12px;
 border: #808080 1px solid;
 empty-cells: show;
}
table.percent_graph td.covered {
 height: 10px;
 background: #00f000;
}
table.percent_graph td.uncovered {
 height: 10px;
 background: #e00000;
}
table.percent_graph td.NA {
 height: 10px;
 background: #eaeaea;
}
table.report {
 border-collapse: collapse;
 width: 100%;
}
table.report td.heading {
 background: #dcecff;
 border: #d0d0d0 1px solid;
 font-weight: bold;
 text-align: center;
}
table.report td.heading:hover {
 background: #c0ffc0;
}
table.report td.text {
 border: #d0d0d0 1px solid;
}
table.report td.value,
table.report td.lines_total,
table.report td.lines_code {
 text-align: right;
 border: #d0d0d0 1px solid;
}
table.report tr.light {
 background-color: rgb(240, 240, 245);
}
table.report tr.dark {
 background-color: rgb(230, 230, 235);
}
</style>
    <script type='text/javascript'>
// <![CDATA[
  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make cross-references hidden by default
  document.writeln( "<style type=\"text/css\">span.cross-ref { display: none }</style>" )
  // ]]>
</script>
    <style type='text/css'>span.run0 {
  background-color: rgb(178, 204, 255);
  display: block;
}
span.run1 {
  background-color: rgb(178, 206, 255);
  display: block;
}
span.run2 {
  background-color: rgb(178, 209, 255);
  display: block;
}
span.run3 {
  background-color: rgb(178, 211, 255);
  display: block;
}
span.run4 {
  background-color: rgb(178, 214, 255);
  display: block;
}
span.run5 {
  background-color: rgb(178, 218, 255);
  display: block;
}
span.run6 {
  background-color: rgb(178, 220, 255);
  display: block;
}
span.run7 {
  background-color: rgb(178, 223, 255);
  display: block;
}
span.run8 {
  background-color: rgb(178, 225, 255);
  display: block;
}
span.run9 {
  background-color: rgb(178, 228, 255);
  display: block;
}
span.run10 {
  background-color: rgb(178, 232, 255);
  display: block;
}
span.run11 {
  background-color: rgb(178, 234, 255);
  display: block;
}
span.run12 {
  background-color: rgb(178, 237, 255);
  display: block;
}
span.run13 {
  background-color: rgb(178, 239, 255);
  display: block;
}
span.run14 {
  background-color: rgb(178, 242, 255);
  display: block;
}
span.run15 {
  background-color: rgb(178, 246, 255);
  display: block;
}
span.run16 {
  background-color: rgb(178, 248, 255);
  display: block;
}
span.run17 {
  background-color: rgb(178, 251, 255);
  display: block;
}
span.run18 {
  background-color: rgb(178, 253, 255);
  display: block;
}
span.run19 {
  background-color: rgb(178, 255, 253);
  display: block;
}
span.run20 {
  background-color: rgb(178, 255, 249);
  display: block;
}
span.run21 {
  background-color: rgb(178, 255, 247);
  display: block;
}
span.run22 {
  background-color: rgb(178, 255, 244);
  display: block;
}
span.run23 {
  background-color: rgb(178, 255, 242);
  display: block;
}
span.run24 {
  background-color: rgb(178, 255, 239);
  display: block;
}
span.run25 {
  background-color: rgb(178, 255, 235);
  display: block;
}
span.run26 {
  background-color: rgb(178, 255, 233);
  display: block;
}
span.run27 {
  background-color: rgb(178, 255, 230);
  display: block;
}
span.run28 {
  background-color: rgb(178, 255, 228);
  display: block;
}
span.run29 {
  background-color: rgb(178, 255, 225);
  display: block;
}
span.run30 {
  background-color: rgb(178, 255, 221);
  display: block;
}
span.run31 {
  background-color: rgb(178, 255, 219);
  display: block;
}
span.run32 {
  background-color: rgb(178, 255, 216);
  display: block;
}
span.run33 {
  background-color: rgb(178, 255, 214);
  display: block;
}
span.run34 {
  background-color: rgb(178, 255, 211);
  display: block;
}
span.run35 {
  background-color: rgb(178, 255, 207);
  display: block;
}
span.run36 {
  background-color: rgb(178, 255, 205);
  display: block;
}
span.run37 {
  background-color: rgb(178, 255, 202);
  display: block;
}
span.run38 {
  background-color: rgb(178, 255, 200);
  display: block;
}
span.run39 {
  background-color: rgb(178, 255, 197);
  display: block;
}
span.run40 {
  background-color: rgb(178, 255, 193);
  display: block;
}
span.run41 {
  background-color: rgb(178, 255, 191);
  display: block;
}
span.run42 {
  background-color: rgb(178, 255, 188);
  display: block;
}
span.run43 {
  background-color: rgb(178, 255, 186);
  display: block;
}
span.run44 {
  background-color: rgb(178, 255, 183);
  display: block;
}
span.run45 {
  background-color: rgb(178, 255, 179);
  display: block;
}
span.run46 {
  background-color: rgb(179, 255, 178);
  display: block;
}
span.run47 {
  background-color: rgb(182, 255, 178);
  display: block;
}
span.run48 {
  background-color: rgb(184, 255, 178);
  display: block;
}
span.run49 {
  background-color: rgb(187, 255, 178);
  display: block;
}
span.run50 {
  background-color: rgb(191, 255, 178);
  display: block;
}
span.run51 {
  background-color: rgb(193, 255, 178);
  display: block;
}
span.run52 {
  background-color: rgb(196, 255, 178);
  display: block;
}
span.run53 {
  background-color: rgb(198, 255, 178);
  display: block;
}
span.run54 {
  background-color: rgb(201, 255, 178);
  display: block;
}
span.run55 {
  background-color: rgb(205, 255, 178);
  display: block;
}
span.run56 {
  background-color: rgb(207, 255, 178);
  display: block;
}
span.run57 {
  background-color: rgb(210, 255, 178);
  display: block;
}
span.run58 {
  background-color: rgb(212, 255, 178);
  display: block;
}
span.run59 {
  background-color: rgb(215, 255, 178);
  display: block;
}
span.run60 {
  background-color: rgb(219, 255, 178);
  display: block;
}
span.run61 {
  background-color: rgb(221, 255, 178);
  display: block;
}
span.run62 {
  background-color: rgb(224, 255, 178);
  display: block;
}
span.run63 {
  background-color: rgb(226, 255, 178);
  display: block;
}
span.run64 {
  background-color: rgb(229, 255, 178);
  display: block;
}
span.run65 {
  background-color: rgb(233, 255, 178);
  display: block;
}
span.run66 {
  background-color: rgb(235, 255, 178);
  display: block;
}
span.run67 {
  background-color: rgb(238, 255, 178);
  display: block;
}
span.run68 {
  background-color: rgb(240, 255, 178);
  display: block;
}
span.run69 {
  background-color: rgb(243, 255, 178);
  display: block;
}
span.run70 {
  background-color: rgb(247, 255, 178);
  display: block;
}
span.run71 {
  background-color: rgb(249, 255, 178);
  display: block;
}
span.run72 {
  background-color: rgb(252, 255, 178);
  display: block;
}
span.run73 {
  background-color: rgb(255, 255, 178);
  display: block;
}
span.run74 {
  background-color: rgb(255, 252, 178);
  display: block;
}
span.run75 {
  background-color: rgb(255, 248, 178);
  display: block;
}
span.run76 {
  background-color: rgb(255, 246, 178);
  display: block;
}
span.run77 {
  background-color: rgb(255, 243, 178);
  display: block;
}
span.run78 {
  background-color: rgb(255, 240, 178);
  display: block;
}
span.run79 {
  background-color: rgb(255, 238, 178);
  display: block;
}
span.run80 {
  background-color: rgb(255, 234, 178);
  display: block;
}
span.run81 {
  background-color: rgb(255, 232, 178);
  display: block;
}
span.run82 {
  background-color: rgb(255, 229, 178);
  display: block;
}
span.run83 {
  background-color: rgb(255, 226, 178);
  display: block;
}
span.run84 {
  background-color: rgb(255, 224, 178);
  display: block;
}
span.run85 {
  background-color: rgb(255, 220, 178);
  display: block;
}
span.run86 {
  background-color: rgb(255, 218, 178);
  display: block;
}
span.run87 {
  background-color: rgb(255, 215, 178);
  display: block;
}
span.run88 {
  background-color: rgb(255, 212, 178);
  display: block;
}
span.run89 {
  background-color: rgb(255, 210, 178);
  display: block;
}
span.run90 {
  background-color: rgb(255, 206, 178);
  display: block;
}
span.run91 {
  background-color: rgb(255, 204, 178);
  display: block;
}
span.run92 {
  background-color: rgb(255, 201, 178);
  display: block;
}
span.run93 {
  background-color: rgb(255, 198, 178);
  display: block;
}
span.run94 {
  background-color: rgb(255, 196, 178);
  display: block;
}
span.run95 {
  background-color: rgb(255, 192, 178);
  display: block;
}
span.run96 {
  background-color: rgb(255, 189, 178);
  display: block;
}
span.run97 {
  background-color: rgb(255, 187, 178);
  display: block;
}
span.run98 {
  background-color: rgb(255, 184, 178);
  display: block;
}
span.run99 {
  background-color: rgb(255, 182, 178);
  display: block;
}
span.run100 {
  background-color: rgb(255, 178, 178);
  display: block;
}
</style>
    </head>
  <body><h3>C0 code coverage information</h3>
    <p>Generated on Wed Feb 11 19:51:13 -0800 2009 with <a href='http://eigenclass.org/hiki/rcov'>rcov 0.8.1.2</a>
      </p>
    <hr/>
    <pre><span class='marked0'>Code reported as executed by Ruby looks like this...
</span><span class='marked1'>and this: this line is also marked as covered.
</span><span class='inferred0'>Lines considered as run by rcov, but not reported by Ruby, look like this,
</span><span class='inferred1'>and this: these lines were inferred by rcov (using simple heuristics).
</span><span class='uncovered0'>Finally, here&apos;s a line marked as not executed.
</span></pre>                       
<table class='report'><thead><tr><td class='heading'>Name</td>
      <td class='heading'>Total lines</td>
      <td class='heading'>Lines of code</td>
      <td class='heading'>Total coverage</td>
      <td class='heading'>Code coverage</td>
      </tr>
    </thead>
  <tbody><tr class='light'><td><a href='-Library-Ruby-Gems-1_8-gems-actionpack-2_2_2-lib-action_view-helpers-date_helper_rb.html'>/Library/Ruby/Gems/1.8/gems/actionpack-2.2.2/lib/action_view/helpers/date_helper.rb</a>
        </td>
      <td class='lines_total'><tt>901</tt>
        </td>
      <td class='lines_code'><tt>360</tt>
        </td>
      <td><table cellspacing='0' cellpadding='0' align='right'><tr><td><tt class='coverage_total'>67.5%</tt>
              &nbsp;</td>
            <td><table cellspacing='0' class='percent_graph' cellpadding='0' width='100'><tr><td class='covered' width='67'/>
                  <td class='uncovered' width='33'/>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      <td><table cellspacing='0' cellpadding='0' align='right'><tr><td><tt class='coverage_code'>29.2%</tt>
              &nbsp;</td>
            <td><table cellspacing='0' class='percent_graph' cellpadding='0' width='100'><tr><td class='covered' width='29'/>
                  <td class='uncovered' width='71'/>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
<pre><span class="marked1"><a name="line1"></a>  1 require &quot;date&quot;
</span><span class="marked0"><a name="line2"></a>  2 require 'action_view/helpers/tag_helper'
</span><span class="inferred1"><a name="line3"></a>  3 
</span><span class="marked0"><a name="line4"></a>  4 module ActionView
</span><span class="marked1"><a name="line5"></a>  5   module Helpers
</span><span class="inferred0"><a name="line6"></a>  6     # The Date Helper primarily creates select/option tags for different kinds of dates and date elements. All of the
</span><span class="inferred1"><a name="line7"></a>  7     # select-type methods share a number of common options that are as follows:
</span><span class="inferred0"><a name="line8"></a>  8     #
</span><span class="inferred1"><a name="line9"></a>  9     # * &lt;tt&gt;:prefix&lt;/tt&gt; - overwrites the default prefix of &quot;date&quot; used for the select names. So specifying &quot;birthday&quot;
</span><span class="inferred0"><a name="line10"></a> 10     # would give birthday[month] instead of date[month] if passed to the select_month method.
</span><span class="inferred1"><a name="line11"></a> 11     # * &lt;tt&gt;:include_blank&lt;/tt&gt; - set to true if it should be possible to set an empty date.
</span><span class="inferred0"><a name="line12"></a> 12     # * &lt;tt&gt;:discard_type&lt;/tt&gt; - set to true if you want to discard the type part of the select name. If set to true,
</span><span class="inferred1"><a name="line13"></a> 13     #   the select_month method would use simply &quot;date&quot; (which can be overwritten using &lt;tt&gt;:prefix&lt;/tt&gt;) instead of
</span><span class="inferred0"><a name="line14"></a> 14     #   &quot;date[month]&quot;.
</span><span class="marked1"><a name="line15"></a> 15     module DateHelper
</span><span class="inferred0"><a name="line16"></a> 16       # Reports the approximate distance in time between two Time or Date objects or integers as seconds.
</span><span class="inferred1"><a name="line17"></a> 17       # Set &lt;tt&gt;include_seconds&lt;/tt&gt; to true if you want more detailed approximations when distance &lt; 1 min, 29 secs
</span><span class="inferred0"><a name="line18"></a> 18       # Distances are reported based on the following table:
</span><span class="inferred1"><a name="line19"></a> 19       #
</span><span class="inferred0"><a name="line20"></a> 20       #   0 &lt;-&gt; 29 secs                                                             # =&gt; less than a minute
</span><span class="inferred1"><a name="line21"></a> 21       #   30 secs &lt;-&gt; 1 min, 29 secs                                                # =&gt; 1 minute
</span><span class="inferred0"><a name="line22"></a> 22       #   1 min, 30 secs &lt;-&gt; 44 mins, 29 secs                                       # =&gt; [2..44] minutes
</span><span class="inferred1"><a name="line23"></a> 23       #   44 mins, 30 secs &lt;-&gt; 89 mins, 29 secs                                     # =&gt; about 1 hour
</span><span class="inferred0"><a name="line24"></a> 24       #   89 mins, 29 secs &lt;-&gt; 23 hrs, 59 mins, 29 secs                             # =&gt; about [2..24] hours
</span><span class="inferred1"><a name="line25"></a> 25       #   23 hrs, 59 mins, 29 secs &lt;-&gt; 47 hrs, 59 mins, 29 secs                     # =&gt; 1 day
</span><span class="inferred0"><a name="line26"></a> 26       #   47 hrs, 59 mins, 29 secs &lt;-&gt; 29 days, 23 hrs, 59 mins, 29 secs            # =&gt; [2..29] days
</span><span class="inferred1"><a name="line27"></a> 27       #   29 days, 23 hrs, 59 mins, 30 secs &lt;-&gt; 59 days, 23 hrs, 59 mins, 29 secs   # =&gt; about 1 month
</span><span class="inferred0"><a name="line28"></a> 28       #   59 days, 23 hrs, 59 mins, 30 secs &lt;-&gt; 1 yr minus 1 sec                    # =&gt; [2..12] months
</span><span class="inferred1"><a name="line29"></a> 29       #   1 yr &lt;-&gt; 2 yrs minus 1 secs                                               # =&gt; about 1 year
</span><span class="inferred0"><a name="line30"></a> 30       #   2 yrs &lt;-&gt; max time or date                                                # =&gt; over [2..X] years
</span><span class="inferred1"><a name="line31"></a> 31       #
</span><span class="inferred0"><a name="line32"></a> 32       # With &lt;tt&gt;include_seconds&lt;/tt&gt; = true and the difference &lt; 1 minute 29 seconds:
</span><span class="inferred1"><a name="line33"></a> 33       #   0-4   secs      # =&gt; less than 5 seconds
</span><span class="inferred0"><a name="line34"></a> 34       #   5-9   secs      # =&gt; less than 10 seconds
</span><span class="inferred1"><a name="line35"></a> 35       #   10-19 secs      # =&gt; less than 20 seconds
</span><span class="inferred0"><a name="line36"></a> 36       #   20-39 secs      # =&gt; half a minute
</span><span class="inferred1"><a name="line37"></a> 37       #   40-59 secs      # =&gt; less than a minute
</span><span class="inferred0"><a name="line38"></a> 38       #   60-89 secs      # =&gt; 1 minute
</span><span class="inferred1"><a name="line39"></a> 39       #
</span><span class="inferred0"><a name="line40"></a> 40       # ==== Examples
</span><span class="inferred1"><a name="line41"></a> 41       #   from_time = Time.now
</span><span class="inferred0"><a name="line42"></a> 42       #   distance_of_time_in_words(from_time, from_time + 50.minutes)        # =&gt; about 1 hour
</span><span class="inferred1"><a name="line43"></a> 43       #   distance_of_time_in_words(from_time, 50.minutes.from_now)           # =&gt; about 1 hour
</span><span class="inferred0"><a name="line44"></a> 44       #   distance_of_time_in_words(from_time, from_time + 15.seconds)        # =&gt; less than a minute
</span><span class="inferred1"><a name="line45"></a> 45       #   distance_of_time_in_words(from_time, from_time + 15.seconds, true)  # =&gt; less than 20 seconds
</span><span class="inferred0"><a name="line46"></a> 46       #   distance_of_time_in_words(from_time, 3.years.from_now)              # =&gt; over 3 years
</span><span class="inferred1"><a name="line47"></a> 47       #   distance_of_time_in_words(from_time, from_time + 60.hours)          # =&gt; about 3 days
</span><span class="inferred0"><a name="line48"></a> 48       #   distance_of_time_in_words(from_time, from_time + 45.seconds, true)  # =&gt; less than a minute
</span><span class="inferred1"><a name="line49"></a> 49       #   distance_of_time_in_words(from_time, from_time - 45.seconds, true)  # =&gt; less than a minute
</span><span class="inferred0"><a name="line50"></a> 50       #   distance_of_time_in_words(from_time, 76.seconds.from_now)           # =&gt; 1 minute
</span><span class="inferred1"><a name="line51"></a> 51       #   distance_of_time_in_words(from_time, from_time + 1.year + 3.days)   # =&gt; about 1 year
</span><span class="inferred0"><a name="line52"></a> 52       #   distance_of_time_in_words(from_time, from_time + 4.years + 9.days + 30.minutes + 5.seconds) # =&gt; over 4 years
</span><span class="inferred1"><a name="line53"></a> 53       #
</span><span class="inferred0"><a name="line54"></a> 54       #   to_time = Time.now + 6.years + 19.days
</span><span class="inferred1"><a name="line55"></a> 55       #   distance_of_time_in_words(from_time, to_time, true)     # =&gt; over 6 years
</span><span class="inferred0"><a name="line56"></a> 56       #   distance_of_time_in_words(to_time, from_time, true)     # =&gt; over 6 years
</span><span class="inferred1"><a name="line57"></a> 57       #   distance_of_time_in_words(Time.now, Time.now)           # =&gt; less than a minute
</span><span class="inferred0"><a name="line58"></a> 58       #
</span><span class="marked1"><a name="line59"></a> 59       def distance_of_time_in_words(from_time, to_time = 0, include_seconds = false, options = {})
</span><span class="uncovered0"><a name="line60"></a> 60         from_time = from_time.to_time if from_time.respond_to?(:to_time)
</span><span class="uncovered1"><a name="line61"></a> 61         to_time = to_time.to_time if to_time.respond_to?(:to_time)
</span><span class="uncovered0"><a name="line62"></a> 62         distance_in_minutes = (((to_time - from_time).abs)/60).round
</span><span class="uncovered1"><a name="line63"></a> 63         distance_in_seconds = ((to_time - from_time).abs).round
</span><span class="uncovered0"><a name="line64"></a> 64 
</span><span class="uncovered1"><a name="line65"></a> 65         I18n.with_options :locale =&gt; options[:locale], :scope =&gt; :'datetime.distance_in_words' do |locale|
</span><span class="uncovered0"><a name="line66"></a> 66           case distance_in_minutes
</span><span class="uncovered1"><a name="line67"></a> 67             when 0..1
</span><span class="uncovered0"><a name="line68"></a> 68               return distance_in_minutes == 0 ?
</span><span class="uncovered1"><a name="line69"></a> 69                      locale.t(:less_than_x_minutes, :count =&gt; 1) :
</span><span class="uncovered0"><a name="line70"></a> 70                      locale.t(:x_minutes, :count =&gt; distance_in_minutes) unless include_seconds
</span><span class="uncovered1"><a name="line71"></a> 71 
</span><span class="uncovered0"><a name="line72"></a> 72               case distance_in_seconds
</span><span class="uncovered1"><a name="line73"></a> 73                 when 0..4   then locale.t :less_than_x_seconds, :count =&gt; 5
</span><span class="uncovered0"><a name="line74"></a> 74                 when 5..9   then locale.t :less_than_x_seconds, :count =&gt; 10
</span><span class="uncovered1"><a name="line75"></a> 75                 when 10..19 then locale.t :less_than_x_seconds, :count =&gt; 20
</span><span class="uncovered0"><a name="line76"></a> 76                 when 20..39 then locale.t :half_a_minute
</span><span class="uncovered1"><a name="line77"></a> 77                 when 40..59 then locale.t :less_than_x_minutes, :count =&gt; 1
</span><span class="uncovered0"><a name="line78"></a> 78                 else             locale.t :x_minutes,           :count =&gt; 1
</span><span class="uncovered1"><a name="line79"></a> 79               end
</span><span class="uncovered0"><a name="line80"></a> 80 
</span><span class="uncovered1"><a name="line81"></a> 81             when 2..44           then locale.t :x_minutes,      :count =&gt; distance_in_minutes
</span><span class="uncovered0"><a name="line82"></a> 82             when 45..89          then locale.t :about_x_hours,  :count =&gt; 1
</span><span class="uncovered1"><a name="line83"></a> 83             when 90..1439        then locale.t :about_x_hours,  :count =&gt; (distance_in_minutes.to_f / 60.0).round
</span><span class="uncovered0"><a name="line84"></a> 84             when 1440..2879      then locale.t :x_days,         :count =&gt; 1
</span><span class="uncovered1"><a name="line85"></a> 85             when 2880..43199     then locale.t :x_days,         :count =&gt; (distance_in_minutes / 1440).round
</span><span class="uncovered0"><a name="line86"></a> 86             when 43200..86399    then locale.t :about_x_months, :count =&gt; 1
</span><span class="uncovered1"><a name="line87"></a> 87             when 86400..525599   then locale.t :x_months,       :count =&gt; (distance_in_minutes / 43200).round
</span><span class="uncovered0"><a name="line88"></a> 88             when 525600..1051199 then locale.t :about_x_years,  :count =&gt; 1
</span><span class="uncovered1"><a name="line89"></a> 89             else                      locale.t :over_x_years,   :count =&gt; (distance_in_minutes / 525600).round
</span><span class="uncovered0"><a name="line90"></a> 90           end
</span><span class="uncovered1"><a name="line91"></a> 91         end
</span><span class="uncovered0"><a name="line92"></a> 92       end
</span><span class="inferred1"><a name="line93"></a> 93 
</span><span class="inferred0"><a name="line94"></a> 94       # Like distance_of_time_in_words, but where &lt;tt&gt;to_time&lt;/tt&gt; is fixed to &lt;tt&gt;Time.now&lt;/tt&gt;.
</span><span class="inferred1"><a name="line95"></a> 95       #
</span><span class="inferred0"><a name="line96"></a> 96       # ==== Examples
</span><span class="inferred1"><a name="line97"></a> 97       #   time_ago_in_words(3.minutes.from_now)       # =&gt; 3 minutes
</span><span class="inferred0"><a name="line98"></a> 98       #   time_ago_in_words(Time.now - 15.hours)      # =&gt; 15 hours
</span><span class="inferred1"><a name="line99"></a> 99       #   time_ago_in_words(Time.now)                 # =&gt; less than a minute
</span><span class="inferred0"><a name="line100"></a>100       #
</span><span class="inferred1"><a name="line101"></a>101       #   from_time = Time.now - 3.days - 14.minutes - 25.seconds     # =&gt; 3 days
</span><span class="marked0"><a name="line102"></a>102       def time_ago_in_words(from_time, include_seconds = false)
</span><span class="uncovered1"><a name="line103"></a>103         distance_of_time_in_words(from_time, Time.now, include_seconds)
</span><span class="uncovered0"><a name="line104"></a>104       end
</span><span class="inferred1"><a name="line105"></a>105 
</span><span class="marked0"><a name="line106"></a>106       alias_method :distance_of_time_in_words_to_now, :time_ago_in_words
</span><span class="inferred1"><a name="line107"></a>107 
</span><span class="inferred0"><a name="line108"></a>108       # Returns a set of select tags (one for year, month, and day) pre-selected for accessing a specified date-based
</span><span class="inferred1"><a name="line109"></a>109       # attribute (identified by +method+) on an object assigned to the template (identified by +object+). You can
</span><span class="inferred0"><a name="line110"></a>110       # the output in the +options+ hash.
</span><span class="inferred1"><a name="line111"></a>111       #
</span><span class="inferred0"><a name="line112"></a>112       # ==== Options
</span><span class="inferred1"><a name="line113"></a>113       # * &lt;tt&gt;:use_month_numbers&lt;/tt&gt; - Set to true if you want to use month numbers rather than month names (e.g.
</span><span class="inferred0"><a name="line114"></a>114       #    &quot;2&quot; instead of &quot;February&quot;).
</span><span class="inferred1"><a name="line115"></a>115       # * &lt;tt&gt;:use_short_month&lt;/tt&gt;   - Set to true if you want to use the abbreviated month name instead of the full
</span><span class="inferred0"><a name="line116"></a>116       #   name (e.g. &quot;Feb&quot; instead of &quot;February&quot;).
</span><span class="inferred1"><a name="line117"></a>117       # * &lt;tt&gt;:add_month_number&lt;/tt&gt;  - Set to true if you want to show both, the month's number and name (e.g.
</span><span class="inferred0"><a name="line118"></a>118       #   &quot;2 - February&quot; instead of &quot;February&quot;).
</span><span class="inferred1"><a name="line119"></a>119       # * &lt;tt&gt;:use_month_names&lt;/tt&gt;   - Set to an array with 12 month names if you want to customize month names.
</span><span class="inferred0"><a name="line120"></a>120       #   Note: You can also use Rails' new i18n functionality for this.
</span><span class="inferred1"><a name="line121"></a>121       # * &lt;tt&gt;:date_separator&lt;/tt&gt;    - Specifies a string to separate the date fields. Default is &quot;&quot; (i.e. nothing).
</span><span class="inferred0"><a name="line122"></a>122       # * &lt;tt&gt;:start_year&lt;/tt&gt;        - Set the start year for the year select. Default is &lt;tt&gt;Time.now.year - 5&lt;/tt&gt;.
</span><span class="inferred1"><a name="line123"></a>123       # * &lt;tt&gt;:end_year&lt;/tt&gt;          - Set the end year for the year select. Default is &lt;tt&gt;Time.now.year + 5&lt;/tt&gt;.
</span><span class="inferred0"><a name="line124"></a>124       # * &lt;tt&gt;:discard_day&lt;/tt&gt;       - Set to true if you don't want to show a day select. This includes the day
</span><span class="inferred1"><a name="line125"></a>125       #   as a hidden field instead of showing a select field. Also note that this implicitly sets the day to be the
</span><span class="inferred0"><a name="line126"></a>126       #   first of the given month in order to not create invalid dates like 31 February.
</span><span class="inferred1"><a name="line127"></a>127       # * &lt;tt&gt;:discard_month&lt;/tt&gt;     - Set to true if you don't want to show a month select. This includes the month
</span><span class="inferred0"><a name="line128"></a>128       #   as a hidden field instead of showing a select field. Also note that this implicitly sets :discard_day to true.
</span><span class="inferred1"><a name="line129"></a>129       # * &lt;tt&gt;:discard_year&lt;/tt&gt;      - Set to true if you don't want to show a year select. This includes the year
</span><span class="inferred0"><a name="line130"></a>130       #   as a hidden field instead of showing a select field.
</span><span class="inferred1"><a name="line131"></a>131       # * &lt;tt&gt;:order&lt;/tt&gt;             - Set to an array containing &lt;tt&gt;:day&lt;/tt&gt;, &lt;tt&gt;:month&lt;/tt&gt; and &lt;tt&gt;:year&lt;/tt&gt; do
</span><span class="inferred0"><a name="line132"></a>132       #   customize the order in which the select fields are shown. If you leave out any of the symbols, the respective
</span><span class="inferred1"><a name="line133"></a>133       #   select will not be shown (like when you set &lt;tt&gt;:discard_xxx =&gt; true&lt;/tt&gt;. Defaults to the order defined in
</span><span class="inferred0"><a name="line134"></a>134       #   the respective locale (e.g. [:year, :month, :day] in the en locale that ships with Rails).
</span><span class="inferred1"><a name="line135"></a>135       # * &lt;tt&gt;:include_blank&lt;/tt&gt;     - Include a blank option in every select field so it's possible to set empty
</span><span class="inferred0"><a name="line136"></a>136       #   dates.
</span><span class="inferred1"><a name="line137"></a>137       # * &lt;tt&gt;:default&lt;/tt&gt;           - Set a default date if the affected date isn't set or is nil.
</span><span class="inferred0"><a name="line138"></a>138       # * &lt;tt&gt;:disabled&lt;/tt&gt;          - Set to true if you want show the select fields as disabled.
</span><span class="inferred1"><a name="line139"></a>139       #
</span><span class="inferred0"><a name="line140"></a>140       # If anything is passed in the +html_options+ hash it will be applied to every select tag in the set.
</span><span class="inferred1"><a name="line141"></a>141       #
</span><span class="inferred0"><a name="line142"></a>142       # NOTE: Discarded selects will default to 1. So if no month select is available, January will be assumed.
</span><span class="inferred1"><a name="line143"></a>143       #
</span><span class="inferred0"><a name="line144"></a>144       # ==== Examples
</span><span class="inferred1"><a name="line145"></a>145       #   # Generates a date select that when POSTed is stored in the post variable, in the written_on attribute
</span><span class="inferred0"><a name="line146"></a>146       #   date_select(&quot;post&quot;, &quot;written_on&quot;)
</span><span class="inferred1"><a name="line147"></a>147       #
</span><span class="inferred0"><a name="line148"></a>148       #   # Generates a date select that when POSTed is stored in the post variable, in the written_on attribute,
</span><span class="inferred1"><a name="line149"></a>149       #   # with the year in the year drop down box starting at 1995.
</span><span class="inferred0"><a name="line150"></a>150       #   date_select(&quot;post&quot;, &quot;written_on&quot;, :start_year =&gt; 1995)
</span><span class="inferred1"><a name="line151"></a>151       #
</span><span class="inferred0"><a name="line152"></a>152       #   # Generates a date select that when POSTed is stored in the post variable, in the written_on attribute,
</span><span class="inferred1"><a name="line153"></a>153       #   # with the year in the year drop down box starting at 1995, numbers used for months instead of words,
</span><span class="inferred0"><a name="line154"></a>154       #   # and without a day select box.
</span><span class="inferred1"><a name="line155"></a>155       #   date_select(&quot;post&quot;, &quot;written_on&quot;, :start_year =&gt; 1995, :use_month_numbers =&gt; true,
</span><span class="inferred0"><a name="line156"></a>156       #                                     :discard_day =&gt; true, :include_blank =&gt; true)
</span><span class="inferred1"><a name="line157"></a>157       #
</span><span class="inferred0"><a name="line158"></a>158       #   # Generates a date select that when POSTed is stored in the post variable, in the written_on attribute
</span><span class="inferred1"><a name="line159"></a>159       #   # with the fields ordered as day, month, year rather than month, day, year.
</span><span class="inferred0"><a name="line160"></a>160       #   date_select(&quot;post&quot;, &quot;written_on&quot;, :order =&gt; [:day, :month, :year])
</span><span class="inferred1"><a name="line161"></a>161       #
</span><span class="inferred0"><a name="line162"></a>162       #   # Generates a date select that when POSTed is stored in the user variable, in the birthday attribute
</span><span class="inferred1"><a name="line163"></a>163       #   # lacking a year field.
</span><span class="inferred0"><a name="line164"></a>164       #   date_select(&quot;user&quot;, &quot;birthday&quot;, :order =&gt; [:month, :day])
</span><span class="inferred1"><a name="line165"></a>165       #
</span><span class="inferred0"><a name="line166"></a>166       #   # Generates a date select that when POSTed is stored in the user variable, in the birthday attribute
</span><span class="inferred1"><a name="line167"></a>167       #   # which is initially set to the date 3 days from the current date
</span><span class="inferred0"><a name="line168"></a>168       #   date_select(&quot;post&quot;, &quot;written_on&quot;, :default =&gt; 3.days.from_now)
</span><span class="inferred1"><a name="line169"></a>169       #
</span><span class="inferred0"><a name="line170"></a>170       #   # Generates a date select that when POSTed is stored in the credit_card variable, in the bill_due attribute
</span><span class="inferred1"><a name="line171"></a>171       #   # that will have a default day of 20.
</span><span class="inferred0"><a name="line172"></a>172       #   date_select(&quot;credit_card&quot;, &quot;bill_due&quot;, :default =&gt; { :day =&gt; 20 })
</span><span class="inferred1"><a name="line173"></a>173       #
</span><span class="inferred0"><a name="line174"></a>174       # The selects are prepared for multi-parameter assignment to an Active Record object.
</span><span class="inferred1"><a name="line175"></a>175       #
</span><span class="inferred0"><a name="line176"></a>176       # Note: If the day is not included as an option but the month is, the day will be set to the 1st to ensure that
</span><span class="inferred1"><a name="line177"></a>177       # all month choices are valid.
</span><span class="marked0"><a name="line178"></a>178       def date_select(object_name, method, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line179"></a>179         InstanceTag.new(object_name, method, self, options.delete(:object)).to_date_select_tag(options, html_options)
</span><span class="uncovered0"><a name="line180"></a>180       end
</span><span class="inferred1"><a name="line181"></a>181 
</span><span class="inferred0"><a name="line182"></a>182       # Returns a set of select tags (one for hour, minute and optionally second) pre-selected for accessing a
</span><span class="inferred1"><a name="line183"></a>183       # specified time-based attribute (identified by +method+) on an object assigned to the template (identified by
</span><span class="inferred0"><a name="line184"></a>184       # +object+). You can include the seconds with &lt;tt&gt;:include_seconds&lt;/tt&gt;.
</span><span class="inferred1"><a name="line185"></a>185       #
</span><span class="inferred0"><a name="line186"></a>186       # This method will also generate 3 input hidden tags, for the actual year, month and day unless the option
</span><span class="inferred1"><a name="line187"></a>187       # &lt;tt&gt;:ignore_date&lt;/tt&gt; is set to +true+.
</span><span class="inferred0"><a name="line188"></a>188       #
</span><span class="inferred1"><a name="line189"></a>189       # If anything is passed in the html_options hash it will be applied to every select tag in the set.
</span><span class="inferred0"><a name="line190"></a>190       #
</span><span class="inferred1"><a name="line191"></a>191       # ==== Examples
</span><span class="inferred0"><a name="line192"></a>192       #   # Creates a time select tag that, when POSTed, will be stored in the post variable in the sunrise attribute
</span><span class="inferred1"><a name="line193"></a>193       #   time_select(&quot;post&quot;, &quot;sunrise&quot;)
</span><span class="inferred0"><a name="line194"></a>194       #
</span><span class="inferred1"><a name="line195"></a>195       #   # Creates a time select tag that, when POSTed, will be stored in the order variable in the submitted
</span><span class="inferred0"><a name="line196"></a>196       #   # attribute
</span><span class="inferred1"><a name="line197"></a>197       #   time_select(&quot;order&quot;, &quot;submitted&quot;)
</span><span class="inferred0"><a name="line198"></a>198       #
</span><span class="inferred1"><a name="line199"></a>199       #   # Creates a time select tag that, when POSTed, will be stored in the mail variable in the sent_at attribute
</span><span class="inferred0"><a name="line200"></a>200       #   time_select(&quot;mail&quot;, &quot;sent_at&quot;)
</span><span class="inferred1"><a name="line201"></a>201       #
</span><span class="inferred0"><a name="line202"></a>202       #   # Creates a time select tag with a seconds field that, when POSTed, will be stored in the post variables in
</span><span class="inferred1"><a name="line203"></a>203       #   # the sunrise attribute.
</span><span class="inferred0"><a name="line204"></a>204       #   time_select(&quot;post&quot;, &quot;start_time&quot;, :include_seconds =&gt; true)
</span><span class="inferred1"><a name="line205"></a>205       #
</span><span class="inferred0"><a name="line206"></a>206       #   # Creates a time select tag with a seconds field that, when POSTed, will be stored in the entry variables in
</span><span class="inferred1"><a name="line207"></a>207       #   # the submission_time attribute.
</span><span class="inferred0"><a name="line208"></a>208       #   time_select(&quot;entry&quot;, &quot;submission_time&quot;, :include_seconds =&gt; true)
</span><span class="inferred1"><a name="line209"></a>209       #
</span><span class="inferred0"><a name="line210"></a>210       #   # You can set the :minute_step to 15 which will give you: 00, 15, 30 and 45.
</span><span class="inferred1"><a name="line211"></a>211       #   time_select 'game', 'game_time', {:minute_step =&gt; 15}
</span><span class="inferred0"><a name="line212"></a>212       #
</span><span class="inferred1"><a name="line213"></a>213       # The selects are prepared for multi-parameter assignment to an Active Record object.
</span><span class="inferred0"><a name="line214"></a>214       #
</span><span class="inferred1"><a name="line215"></a>215       # Note: If the day is not included as an option but the month is, the day will be set to the 1st to ensure that
</span><span class="inferred0"><a name="line216"></a>216       # all month choices are valid.
</span><span class="marked1"><a name="line217"></a>217       def time_select(object_name, method, options = {}, html_options = {})
</span><span class="uncovered0"><a name="line218"></a>218         InstanceTag.new(object_name, method, self, options.delete(:object)).to_time_select_tag(options, html_options)
</span><span class="uncovered1"><a name="line219"></a>219       end
</span><span class="inferred0"><a name="line220"></a>220 
</span><span class="inferred1"><a name="line221"></a>221       # Returns a set of select tags (one for year, month, day, hour, and minute) pre-selected for accessing a
</span><span class="inferred0"><a name="line222"></a>222       # specified datetime-based attribute (identified by +method+) on an object assigned to the template (identified
</span><span class="inferred1"><a name="line223"></a>223       # by +object+). Examples:
</span><span class="inferred0"><a name="line224"></a>224       #
</span><span class="inferred1"><a name="line225"></a>225       # If anything is passed in the html_options hash it will be applied to every select tag in the set.
</span><span class="inferred0"><a name="line226"></a>226       #
</span><span class="inferred1"><a name="line227"></a>227       # ==== Examples
</span><span class="inferred0"><a name="line228"></a>228       #   # Generates a datetime select that, when POSTed, will be stored in the post variable in the written_on
</span><span class="inferred1"><a name="line229"></a>229       #   # attribute
</span><span class="inferred0"><a name="line230"></a>230       #   datetime_select(&quot;post&quot;, &quot;written_on&quot;)
</span><span class="inferred1"><a name="line231"></a>231       #
</span><span class="inferred0"><a name="line232"></a>232       #   # Generates a datetime select with a year select that starts at 1995 that, when POSTed, will be stored in the
</span><span class="inferred1"><a name="line233"></a>233       #   # post variable in the written_on attribute.
</span><span class="inferred0"><a name="line234"></a>234       #   datetime_select(&quot;post&quot;, &quot;written_on&quot;, :start_year =&gt; 1995)
</span><span class="inferred1"><a name="line235"></a>235       #
</span><span class="inferred0"><a name="line236"></a>236       #   # Generates a datetime select with a default value of 3 days from the current time that, when POSTed, will
</span><span class="inferred1"><a name="line237"></a>237       #   # be stored in the trip variable in the departing attribute.
</span><span class="inferred0"><a name="line238"></a>238       #   datetime_select(&quot;trip&quot;, &quot;departing&quot;, :default =&gt; 3.days.from_now)
</span><span class="inferred1"><a name="line239"></a>239       #
</span><span class="inferred0"><a name="line240"></a>240       #   # Generates a datetime select that discards the type that, when POSTed, will be stored in the post variable
</span><span class="inferred1"><a name="line241"></a>241       #   # as the written_on attribute.
</span><span class="inferred0"><a name="line242"></a>242       #   datetime_select(&quot;post&quot;, &quot;written_on&quot;, :discard_type =&gt; true)
</span><span class="inferred1"><a name="line243"></a>243       #
</span><span class="inferred0"><a name="line244"></a>244       # The selects are prepared for multi-parameter assignment to an Active Record object.
</span><span class="marked1"><a name="line245"></a>245       def datetime_select(object_name, method, options = {}, html_options = {})
</span><span class="uncovered0"><a name="line246"></a>246         InstanceTag.new(object_name, method, self, options.delete(:object)).to_datetime_select_tag(options, html_options)
</span><span class="uncovered1"><a name="line247"></a>247       end
</span><span class="inferred0"><a name="line248"></a>248 
</span><span class="inferred1"><a name="line249"></a>249       # Returns a set of html select-tags (one for year, month, day, hour, and minute) pre-selected with the
</span><span class="inferred0"><a name="line250"></a>250       # +datetime+. It's also possible to explicitly set the order of the tags using the &lt;tt&gt;:order&lt;/tt&gt; option with
</span><span class="inferred1"><a name="line251"></a>251       # an array of symbols &lt;tt&gt;:year&lt;/tt&gt;, &lt;tt&gt;:month&lt;/tt&gt; and &lt;tt&gt;:day&lt;/tt&gt; in the desired order. If you do not
</span><span class="inferred0"><a name="line252"></a>252       # supply a Symbol, it will be appended onto the &lt;tt&gt;:order&lt;/tt&gt; passed in. You can also add
</span><span class="inferred1"><a name="line253"></a>253       # &lt;tt&gt;:date_separator&lt;/tt&gt;, &lt;tt&gt;:datetime_separator&lt;/tt&gt; and &lt;tt&gt;:time_separator&lt;/tt&gt; keys to the +options+ to
</span><span class="inferred0"><a name="line254"></a>254       # control visual display of the elements.
</span><span class="inferred1"><a name="line255"></a>255       #
</span><span class="inferred0"><a name="line256"></a>256       # If anything is passed in the html_options hash it will be applied to every select tag in the set.
</span><span class="inferred1"><a name="line257"></a>257       #
</span><span class="inferred0"><a name="line258"></a>258       # ==== Examples
</span><span class="inferred1"><a name="line259"></a>259       #   my_date_time = Time.now + 4.days
</span><span class="inferred0"><a name="line260"></a>260       #
</span><span class="inferred1"><a name="line261"></a>261       #   # Generates a datetime select that defaults to the datetime in my_date_time (four days after today)
</span><span class="inferred0"><a name="line262"></a>262       #   select_datetime(my_date_time)
</span><span class="inferred1"><a name="line263"></a>263       #
</span><span class="inferred0"><a name="line264"></a>264       #   # Generates a datetime select that defaults to today (no specified datetime)
</span><span class="inferred1"><a name="line265"></a>265       #   select_datetime()
</span><span class="inferred0"><a name="line266"></a>266       #
</span><span class="inferred1"><a name="line267"></a>267       #   # Generates a datetime select that defaults to the datetime in my_date_time (four days after today)
</span><span class="inferred0"><a name="line268"></a>268       #   # with the fields ordered year, month, day rather than month, day, year.
</span><span class="inferred1"><a name="line269"></a>269       #   select_datetime(my_date_time, :order =&gt; [:year, :month, :day])
</span><span class="inferred0"><a name="line270"></a>270       #
</span><span class="inferred1"><a name="line271"></a>271       #   # Generates a datetime select that defaults to the datetime in my_date_time (four days after today)
</span><span class="inferred0"><a name="line272"></a>272       #   # with a '/' between each date field.
</span><span class="inferred1"><a name="line273"></a>273       #   select_datetime(my_date_time, :date_separator =&gt; '/')
</span><span class="inferred0"><a name="line274"></a>274       #
</span><span class="inferred1"><a name="line275"></a>275       #   # Generates a datetime select that defaults to the datetime in my_date_time (four days after today)
</span><span class="inferred0"><a name="line276"></a>276       #   # with a date fields separated by '/', time fields separated by '' and the date and time fields
</span><span class="inferred1"><a name="line277"></a>277       #   # separated by a comma (',').
</span><span class="inferred0"><a name="line278"></a>278       #   select_datetime(my_date_time, :date_separator =&gt; '/', :time_separator =&gt; '', :datetime_separator =&gt; ',')
</span><span class="inferred1"><a name="line279"></a>279       #
</span><span class="inferred0"><a name="line280"></a>280       #   # Generates a datetime select that discards the type of the field and defaults to the datetime in
</span><span class="inferred1"><a name="line281"></a>281       #   # my_date_time (four days after today)
</span><span class="inferred0"><a name="line282"></a>282       #   select_datetime(my_date_time, :discard_type =&gt; true)
</span><span class="inferred1"><a name="line283"></a>283       #
</span><span class="inferred0"><a name="line284"></a>284       #   # Generates a datetime select that defaults to the datetime in my_date_time (four days after today)
</span><span class="inferred1"><a name="line285"></a>285       #   # prefixed with 'payday' rather than 'date'
</span><span class="inferred0"><a name="line286"></a>286       #   select_datetime(my_date_time, :prefix =&gt; 'payday')
</span><span class="inferred1"><a name="line287"></a>287       #
</span><span class="marked0"><a name="line288"></a>288       def select_datetime(datetime = Time.current, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line289"></a>289         DateTimeSelector.new(datetime, options, html_options).select_datetime
</span><span class="uncovered0"><a name="line290"></a>290       end
</span><span class="inferred1"><a name="line291"></a>291 
</span><span class="inferred0"><a name="line292"></a>292       # Returns a set of html select-tags (one for year, month, and day) pre-selected with the +date+.
</span><span class="inferred1"><a name="line293"></a>293       # It's possible to explicitly set the order of the tags using the &lt;tt&gt;:order&lt;/tt&gt; option with an array of
</span><span class="inferred0"><a name="line294"></a>294       # symbols &lt;tt&gt;:year&lt;/tt&gt;, &lt;tt&gt;:month&lt;/tt&gt; and &lt;tt&gt;:day&lt;/tt&gt; in the desired order. If you do not supply a Symbol,
</span><span class="inferred1"><a name="line295"></a>295       # it will be appended onto the &lt;tt&gt;:order&lt;/tt&gt; passed in.
</span><span class="inferred0"><a name="line296"></a>296       #
</span><span class="inferred1"><a name="line297"></a>297       # If anything is passed in the html_options hash it will be applied to every select tag in the set.
</span><span class="inferred0"><a name="line298"></a>298       #
</span><span class="inferred1"><a name="line299"></a>299       # ==== Examples
</span><span class="inferred0"><a name="line300"></a>300       #   my_date = Time.today + 6.days
</span><span class="inferred1"><a name="line301"></a>301       #
</span><span class="inferred0"><a name="line302"></a>302       #   # Generates a date select that defaults to the date in my_date (six days after today)
</span><span class="inferred1"><a name="line303"></a>303       #   select_date(my_date)
</span><span class="inferred0"><a name="line304"></a>304       #
</span><span class="inferred1"><a name="line305"></a>305       #   # Generates a date select that defaults to today (no specified date)
</span><span class="inferred0"><a name="line306"></a>306       #   select_date()
</span><span class="inferred1"><a name="line307"></a>307       #
</span><span class="inferred0"><a name="line308"></a>308       #   # Generates a date select that defaults to the date in my_date (six days after today)
</span><span class="inferred1"><a name="line309"></a>309       #   # with the fields ordered year, month, day rather than month, day, year.
</span><span class="inferred0"><a name="line310"></a>310       #   select_date(my_date, :order =&gt; [:year, :month, :day])
</span><span class="inferred1"><a name="line311"></a>311       #
</span><span class="inferred0"><a name="line312"></a>312       #   # Generates a date select that discards the type of the field and defaults to the date in
</span><span class="inferred1"><a name="line313"></a>313       #   # my_date (six days after today)
</span><span class="inferred0"><a name="line314"></a>314       #   select_date(my_date, :discard_type =&gt; true)
</span><span class="inferred1"><a name="line315"></a>315       #
</span><span class="inferred0"><a name="line316"></a>316       #   # Generates a date select that defaults to the date in my_date,
</span><span class="inferred1"><a name="line317"></a>317       #   # which has fields separated by '/'
</span><span class="inferred0"><a name="line318"></a>318       #   select_date(my_date, :date_separator =&gt; '/')
</span><span class="inferred1"><a name="line319"></a>319       #
</span><span class="inferred0"><a name="line320"></a>320       #   # Generates a date select that defaults to the datetime in my_date (six days after today)
</span><span class="inferred1"><a name="line321"></a>321       #   # prefixed with 'payday' rather than 'date'
</span><span class="inferred0"><a name="line322"></a>322       #   select_date(my_date, :prefix =&gt; 'payday')
</span><span class="inferred1"><a name="line323"></a>323       #
</span><span class="marked0"><a name="line324"></a>324       def select_date(date = Date.current, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line325"></a>325         DateTimeSelector.new(date, options, html_options).select_date
</span><span class="uncovered0"><a name="line326"></a>326       end
</span><span class="inferred1"><a name="line327"></a>327 
</span><span class="inferred0"><a name="line328"></a>328       # Returns a set of html select-tags (one for hour and minute)
</span><span class="inferred1"><a name="line329"></a>329       # You can set &lt;tt&gt;:time_separator&lt;/tt&gt; key to format the output, and
</span><span class="inferred0"><a name="line330"></a>330       # the &lt;tt&gt;:include_seconds&lt;/tt&gt; option to include an input for seconds.
</span><span class="inferred1"><a name="line331"></a>331       #
</span><span class="inferred0"><a name="line332"></a>332       # If anything is passed in the html_options hash it will be applied to every select tag in the set.
</span><span class="inferred1"><a name="line333"></a>333       #
</span><span class="inferred0"><a name="line334"></a>334       # ==== Examples
</span><span class="inferred1"><a name="line335"></a>335       #   my_time = Time.now + 5.days + 7.hours + 3.minutes + 14.seconds
</span><span class="inferred0"><a name="line336"></a>336       #
</span><span class="inferred1"><a name="line337"></a>337       #   # Generates a time select that defaults to the time in my_time
</span><span class="inferred0"><a name="line338"></a>338       #   select_time(my_time)
</span><span class="inferred1"><a name="line339"></a>339       #
</span><span class="inferred0"><a name="line340"></a>340       #   # Generates a time select that defaults to the current time (no specified time)
</span><span class="inferred1"><a name="line341"></a>341       #   select_time()
</span><span class="inferred0"><a name="line342"></a>342       #
</span><span class="inferred1"><a name="line343"></a>343       #   # Generates a time select that defaults to the time in my_time,
</span><span class="inferred0"><a name="line344"></a>344       #   # which has fields separated by ':'
</span><span class="inferred1"><a name="line345"></a>345       #   select_time(my_time, :time_separator =&gt; ':')
</span><span class="inferred0"><a name="line346"></a>346       #
</span><span class="inferred1"><a name="line347"></a>347       #   # Generates a time select that defaults to the time in my_time,
</span><span class="inferred0"><a name="line348"></a>348       #   # that also includes an input for seconds
</span><span class="inferred1"><a name="line349"></a>349       #   select_time(my_time, :include_seconds =&gt; true)
</span><span class="inferred0"><a name="line350"></a>350       #
</span><span class="inferred1"><a name="line351"></a>351       #   # Generates a time select that defaults to the time in my_time, that has fields
</span><span class="inferred0"><a name="line352"></a>352       #   # separated by ':' and includes an input for seconds
</span><span class="inferred1"><a name="line353"></a>353       #   select_time(my_time, :time_separator =&gt; ':', :include_seconds =&gt; true)
</span><span class="inferred0"><a name="line354"></a>354       #
</span><span class="marked1"><a name="line355"></a>355       def select_time(datetime = Time.current, options = {}, html_options = {})
</span><span class="uncovered0"><a name="line356"></a>356         DateTimeSelector.new(datetime, options, html_options).select_time
</span><span class="uncovered1"><a name="line357"></a>357       end
</span><span class="inferred0"><a name="line358"></a>358 
</span><span class="inferred1"><a name="line359"></a>359       # Returns a select tag with options for each of the seconds 0 through 59 with the current second selected.
</span><span class="inferred0"><a name="line360"></a>360       # The &lt;tt&gt;second&lt;/tt&gt; can also be substituted for a second number.
</span><span class="inferred1"><a name="line361"></a>361       # Override the field name using the &lt;tt&gt;:field_name&lt;/tt&gt; option, 'second' by default.
</span><span class="inferred0"><a name="line362"></a>362       #
</span><span class="inferred1"><a name="line363"></a>363       # ==== Examples
</span><span class="inferred0"><a name="line364"></a>364       #   my_time = Time.now + 16.minutes
</span><span class="inferred1"><a name="line365"></a>365       #
</span><span class="inferred0"><a name="line366"></a>366       #   # Generates a select field for seconds that defaults to the seconds for the time in my_time
</span><span class="inferred1"><a name="line367"></a>367       #   select_second(my_time)
</span><span class="inferred0"><a name="line368"></a>368       #
</span><span class="inferred1"><a name="line369"></a>369       #   # Generates a select field for seconds that defaults to the number given
</span><span class="inferred0"><a name="line370"></a>370       #   select_second(33)
</span><span class="inferred1"><a name="line371"></a>371       #
</span><span class="inferred0"><a name="line372"></a>372       #   # Generates a select field for seconds that defaults to the seconds for the time in my_time
</span><span class="inferred1"><a name="line373"></a>373       #   # that is named 'interval' rather than 'second'
</span><span class="inferred0"><a name="line374"></a>374       #   select_second(my_time, :field_name =&gt; 'interval')
</span><span class="inferred1"><a name="line375"></a>375       #
</span><span class="marked0"><a name="line376"></a>376       def select_second(datetime, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line377"></a>377         DateTimeSelector.new(datetime, options, html_options).select_second
</span><span class="uncovered0"><a name="line378"></a>378       end
</span><span class="inferred1"><a name="line379"></a>379 
</span><span class="inferred0"><a name="line380"></a>380       # Returns a select tag with options for each of the minutes 0 through 59 with the current minute selected.
</span><span class="inferred1"><a name="line381"></a>381       # Also can return a select tag with options by &lt;tt&gt;minute_step&lt;/tt&gt; from 0 through 59 with the 00 minute
</span><span class="inferred0"><a name="line382"></a>382       # selected. The &lt;tt&gt;minute&lt;/tt&gt; can also be substituted for a minute number.
</span><span class="inferred1"><a name="line383"></a>383       # Override the field name using the &lt;tt&gt;:field_name&lt;/tt&gt; option, 'minute' by default.
</span><span class="inferred0"><a name="line384"></a>384       #
</span><span class="inferred1"><a name="line385"></a>385       # ==== Examples
</span><span class="inferred0"><a name="line386"></a>386       #   my_time = Time.now + 6.hours
</span><span class="inferred1"><a name="line387"></a>387       #
</span><span class="inferred0"><a name="line388"></a>388       #   # Generates a select field for minutes that defaults to the minutes for the time in my_time
</span><span class="inferred1"><a name="line389"></a>389       #   select_minute(my_time)
</span><span class="inferred0"><a name="line390"></a>390       #
</span><span class="inferred1"><a name="line391"></a>391       #   # Generates a select field for minutes that defaults to the number given
</span><span class="inferred0"><a name="line392"></a>392       #   select_minute(14)
</span><span class="inferred1"><a name="line393"></a>393       #
</span><span class="inferred0"><a name="line394"></a>394       #   # Generates a select field for minutes that defaults to the minutes for the time in my_time
</span><span class="inferred1"><a name="line395"></a>395       #   # that is named 'stride' rather than 'second'
</span><span class="inferred0"><a name="line396"></a>396       #   select_minute(my_time, :field_name =&gt; 'stride')
</span><span class="inferred1"><a name="line397"></a>397       #
</span><span class="marked0"><a name="line398"></a>398       def select_minute(datetime, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line399"></a>399         DateTimeSelector.new(datetime, options, html_options).select_minute
</span><span class="uncovered0"><a name="line400"></a>400       end
</span><span class="inferred1"><a name="line401"></a>401 
</span><span class="inferred0"><a name="line402"></a>402       # Returns a select tag with options for each of the hours 0 through 23 with the current hour selected.
</span><span class="inferred1"><a name="line403"></a>403       # The &lt;tt&gt;hour&lt;/tt&gt; can also be substituted for a hour number.
</span><span class="inferred0"><a name="line404"></a>404       # Override the field name using the &lt;tt&gt;:field_name&lt;/tt&gt; option, 'hour' by default.
</span><span class="inferred1"><a name="line405"></a>405       #
</span><span class="inferred0"><a name="line406"></a>406       # ==== Examples
</span><span class="inferred1"><a name="line407"></a>407       #   my_time = Time.now + 6.hours
</span><span class="inferred0"><a name="line408"></a>408       #
</span><span class="inferred1"><a name="line409"></a>409       #   # Generates a select field for hours that defaults to the hour for the time in my_time
</span><span class="inferred0"><a name="line410"></a>410       #   select_hour(my_time)
</span><span class="inferred1"><a name="line411"></a>411       #
</span><span class="inferred0"><a name="line412"></a>412       #   # Generates a select field for hours that defaults to the number given
</span><span class="inferred1"><a name="line413"></a>413       #   select_hour(13)
</span><span class="inferred0"><a name="line414"></a>414       #
</span><span class="inferred1"><a name="line415"></a>415       #   # Generates a select field for hours that defaults to the minutes for the time in my_time
</span><span class="inferred0"><a name="line416"></a>416       #   # that is named 'stride' rather than 'second'
</span><span class="inferred1"><a name="line417"></a>417       #   select_hour(my_time, :field_name =&gt; 'stride')
</span><span class="inferred0"><a name="line418"></a>418       #
</span><span class="marked1"><a name="line419"></a>419       def select_hour(datetime, options = {}, html_options = {})
</span><span class="uncovered0"><a name="line420"></a>420         DateTimeSelector.new(datetime, options, html_options).select_hour
</span><span class="uncovered1"><a name="line421"></a>421       end
</span><span class="inferred0"><a name="line422"></a>422 
</span><span class="inferred1"><a name="line423"></a>423       # Returns a select tag with options for each of the days 1 through 31 with the current day selected.
</span><span class="inferred0"><a name="line424"></a>424       # The &lt;tt&gt;date&lt;/tt&gt; can also be substituted for a hour number.
</span><span class="inferred1"><a name="line425"></a>425       # Override the field name using the &lt;tt&gt;:field_name&lt;/tt&gt; option, 'day' by default.
</span><span class="inferred0"><a name="line426"></a>426       #
</span><span class="inferred1"><a name="line427"></a>427       # ==== Examples
</span><span class="inferred0"><a name="line428"></a>428       #   my_date = Time.today + 2.days
</span><span class="inferred1"><a name="line429"></a>429       #
</span><span class="inferred0"><a name="line430"></a>430       #   # Generates a select field for days that defaults to the day for the date in my_date
</span><span class="inferred1"><a name="line431"></a>431       #   select_day(my_time)
</span><span class="inferred0"><a name="line432"></a>432       #
</span><span class="inferred1"><a name="line433"></a>433       #   # Generates a select field for days that defaults to the number given
</span><span class="inferred0"><a name="line434"></a>434       #   select_day(5)
</span><span class="inferred1"><a name="line435"></a>435       #
</span><span class="inferred0"><a name="line436"></a>436       #   # Generates a select field for days that defaults to the day for the date in my_date
</span><span class="inferred1"><a name="line437"></a>437       #   # that is named 'due' rather than 'day'
</span><span class="inferred0"><a name="line438"></a>438       #   select_day(my_time, :field_name =&gt; 'due')
</span><span class="inferred1"><a name="line439"></a>439       #
</span><span class="marked0"><a name="line440"></a>440       def select_day(date, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line441"></a>441         DateTimeSelector.new(date, options, html_options).select_day
</span><span class="uncovered0"><a name="line442"></a>442       end
</span><span class="inferred1"><a name="line443"></a>443 
</span><span class="inferred0"><a name="line444"></a>444       # Returns a select tag with options for each of the months January through December with the current month
</span><span class="inferred1"><a name="line445"></a>445       # selected. The month names are presented as keys (what's shown to the user) and the month numbers (1-12) are
</span><span class="inferred0"><a name="line446"></a>446       # used as values (what's submitted to the server). It's also possible to use month numbers for the presentation
</span><span class="inferred1"><a name="line447"></a>447       # instead of names -- set the &lt;tt&gt;:use_month_numbers&lt;/tt&gt; key in +options+ to true for this to happen. If you
</span><span class="inferred0"><a name="line448"></a>448       # want both numbers and names, set the &lt;tt&gt;:add_month_numbers&lt;/tt&gt; key in +options+ to true. If you would prefer
</span><span class="inferred1"><a name="line449"></a>449       # to show month names as abbreviations, set the &lt;tt&gt;:use_short_month&lt;/tt&gt; key in +options+ to true. If you want
</span><span class="inferred0"><a name="line450"></a>450       # to use your own month names, set the &lt;tt&gt;:use_month_names&lt;/tt&gt; key in +options+ to an array of 12 month names.
</span><span class="inferred1"><a name="line451"></a>451       # Override the field name using the &lt;tt&gt;:field_name&lt;/tt&gt; option, 'month' by default.
</span><span class="inferred0"><a name="line452"></a>452       #
</span><span class="inferred1"><a name="line453"></a>453       # ==== Examples
</span><span class="inferred0"><a name="line454"></a>454       #   # Generates a select field for months that defaults to the current month that
</span><span class="inferred1"><a name="line455"></a>455       #   # will use keys like &quot;January&quot;, &quot;March&quot;.
</span><span class="inferred0"><a name="line456"></a>456       #   select_month(Date.today)
</span><span class="inferred1"><a name="line457"></a>457       #
</span><span class="inferred0"><a name="line458"></a>458       #   # Generates a select field for months that defaults to the current month that
</span><span class="inferred1"><a name="line459"></a>459       #   # is named &quot;start&quot; rather than &quot;month&quot;
</span><span class="inferred0"><a name="line460"></a>460       #   select_month(Date.today, :field_name =&gt; 'start')
</span><span class="inferred1"><a name="line461"></a>461       #
</span><span class="inferred0"><a name="line462"></a>462       #   # Generates a select field for months that defaults to the current month that
</span><span class="inferred1"><a name="line463"></a>463       #   # will use keys like &quot;1&quot;, &quot;3&quot;.
</span><span class="inferred0"><a name="line464"></a>464       #   select_month(Date.today, :use_month_numbers =&gt; true)
</span><span class="inferred1"><a name="line465"></a>465       #
</span><span class="inferred0"><a name="line466"></a>466       #   # Generates a select field for months that defaults to the current month that
</span><span class="inferred1"><a name="line467"></a>467       #   # will use keys like &quot;1 - January&quot;, &quot;3 - March&quot;.
</span><span class="inferred0"><a name="line468"></a>468       #   select_month(Date.today, :add_month_numbers =&gt; true)
</span><span class="inferred1"><a name="line469"></a>469       #
</span><span class="inferred0"><a name="line470"></a>470       #   # Generates a select field for months that defaults to the current month that
</span><span class="inferred1"><a name="line471"></a>471       #   # will use keys like &quot;Jan&quot;, &quot;Mar&quot;.
</span><span class="inferred0"><a name="line472"></a>472       #   select_month(Date.today, :use_short_month =&gt; true)
</span><span class="inferred1"><a name="line473"></a>473       #
</span><span class="inferred0"><a name="line474"></a>474       #   # Generates a select field for months that defaults to the current month that
</span><span class="inferred1"><a name="line475"></a>475       #   # will use keys like &quot;Januar&quot;, &quot;Marts.&quot;
</span><span class="inferred0"><a name="line476"></a>476       #   select_month(Date.today, :use_month_names =&gt; %w(Januar Februar Marts ...))
</span><span class="inferred1"><a name="line477"></a>477       #
</span><span class="marked0"><a name="line478"></a>478       def select_month(date, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line479"></a>479         DateTimeSelector.new(date, options, html_options).select_month
</span><span class="uncovered0"><a name="line480"></a>480       end
</span><span class="inferred1"><a name="line481"></a>481 
</span><span class="inferred0"><a name="line482"></a>482       # Returns a select tag with options for each of the five years on each side of the current, which is selected.
</span><span class="inferred1"><a name="line483"></a>483       # The five year radius can be changed using the &lt;tt&gt;:start_year&lt;/tt&gt; and &lt;tt&gt;:end_year&lt;/tt&gt; keys in the
</span><span class="inferred0"><a name="line484"></a>484       # +options+. Both ascending and descending year lists are supported by making &lt;tt&gt;:start_year&lt;/tt&gt; less than or
</span><span class="inferred1"><a name="line485"></a>485       # greater than &lt;tt&gt;:end_year&lt;/tt&gt;. The &lt;tt&gt;date&lt;/tt&gt; can also be substituted for a year given as a number.
</span><span class="inferred0"><a name="line486"></a>486       # Override the field name using the &lt;tt&gt;:field_name&lt;/tt&gt; option, 'year' by default.
</span><span class="inferred1"><a name="line487"></a>487       #
</span><span class="inferred0"><a name="line488"></a>488       # ==== Examples
</span><span class="inferred1"><a name="line489"></a>489       #   # Generates a select field for years that defaults to the current year that
</span><span class="inferred0"><a name="line490"></a>490       #   # has ascending year values
</span><span class="inferred1"><a name="line491"></a>491       #   select_year(Date.today, :start_year =&gt; 1992, :end_year =&gt; 2007)
</span><span class="inferred0"><a name="line492"></a>492       #
</span><span class="inferred1"><a name="line493"></a>493       #   # Generates a select field for years that defaults to the current year that
</span><span class="inferred0"><a name="line494"></a>494       #   # is named 'birth' rather than 'year'
</span><span class="inferred1"><a name="line495"></a>495       #   select_year(Date.today, :field_name =&gt; 'birth')
</span><span class="inferred0"><a name="line496"></a>496       #
</span><span class="inferred1"><a name="line497"></a>497       #   # Generates a select field for years that defaults to the current year that
</span><span class="inferred0"><a name="line498"></a>498       #   # has descending year values
</span><span class="inferred1"><a name="line499"></a>499       #   select_year(Date.today, :start_year =&gt; 2005, :end_year =&gt; 1900)
</span><span class="inferred0"><a name="line500"></a>500       #
</span><span class="inferred1"><a name="line501"></a>501       #   # Generates a select field for years that defaults to the year 2006 that
</span><span class="inferred0"><a name="line502"></a>502       #   # has ascending year values
</span><span class="inferred1"><a name="line503"></a>503       #   select_year(2006, :start_year =&gt; 2000, :end_year =&gt; 2010)
</span><span class="inferred0"><a name="line504"></a>504       #
</span><span class="marked1"><a name="line505"></a>505       def select_year(date, options = {}, html_options = {})
</span><span class="uncovered0"><a name="line506"></a>506         DateTimeSelector.new(date, options, html_options).select_year
</span><span class="uncovered1"><a name="line507"></a>507       end
</span><span class="uncovered0"><a name="line508"></a>508     end
</span><span class="inferred1"><a name="line509"></a>509 
</span><span class="marked0"><a name="line510"></a>510     class DateTimeSelector #:nodoc:
</span><span class="marked1"><a name="line511"></a>511       extend ActiveSupport::Memoizable
</span><span class="marked0"><a name="line512"></a>512       include ActionView::Helpers::TagHelper
</span><span class="inferred1"><a name="line513"></a>513 
</span><span class="marked0"><a name="line514"></a>514       DEFAULT_PREFIX = 'date'.freeze unless const_defined?('DEFAULT_PREFIX')
</span><span class="uncovered1"><a name="line515"></a>515       POSITION = {
</span><span class="uncovered0"><a name="line516"></a>516         :year =&gt; 1, :month =&gt; 2, :day =&gt; 3, :hour =&gt; 4, :minute =&gt; 5, :second =&gt; 6
</span><span class="marked1"><a name="line517"></a>517       }.freeze unless const_defined?('POSITION')
</span><span class="inferred0"><a name="line518"></a>518 
</span><span class="marked1"><a name="line519"></a>519       def initialize(datetime, options = {}, html_options = {})
</span><span class="uncovered0"><a name="line520"></a>520         @options      = options.dup
</span><span class="uncovered1"><a name="line521"></a>521         @html_options = html_options.dup
</span><span class="uncovered0"><a name="line522"></a>522         @datetime     = datetime
</span><span class="uncovered1"><a name="line523"></a>523       end
</span><span class="inferred0"><a name="line524"></a>524 
</span><span class="marked1"><a name="line525"></a>525       def select_datetime
</span><span class="uncovered0"><a name="line526"></a>526         # TODO: Remove tag conditional
</span><span class="uncovered1"><a name="line527"></a>527         # Ideally we could just join select_date and select_date for the tag case
</span><span class="uncovered0"><a name="line528"></a>528         if @options[:tag] &amp;&amp; @options[:ignore_date]
</span><span class="uncovered1"><a name="line529"></a>529           select_time
</span><span class="uncovered0"><a name="line530"></a>530         elsif @options[:tag]
</span><span class="uncovered1"><a name="line531"></a>531           order = date_order.dup
</span><span class="uncovered0"><a name="line532"></a>532           order -= [:hour, :minute, :second]
</span><span class="uncovered1"><a name="line533"></a>533 
</span><span class="uncovered0"><a name="line534"></a>534           @options[:discard_year]   ||= true unless order.include?(:year)
</span><span class="uncovered1"><a name="line535"></a>535           @options[:discard_month]  ||= true unless order.include?(:month)
</span><span class="uncovered0"><a name="line536"></a>536           @options[:discard_day]    ||= true if @options[:discard_month] || !order.include?(:day)
</span><span class="uncovered1"><a name="line537"></a>537           @options[:discard_minute] ||= true if @options[:discard_hour]
</span><span class="uncovered0"><a name="line538"></a>538           @options[:discard_second] ||= true unless @options[:include_seconds] &amp;&amp; !@options[:discard_minute]
</span><span class="uncovered1"><a name="line539"></a>539 
</span><span class="uncovered0"><a name="line540"></a>540           # If the day is hidden and the month is visible, the day should be set to the 1st so all month choices are
</span><span class="uncovered1"><a name="line541"></a>541           # valid (otherwise it could be 31 and february wouldn't be a valid date)
</span><span class="uncovered0"><a name="line542"></a>542           if @datetime &amp;&amp; @options[:discard_day] &amp;&amp; !@options[:discard_month]
</span><span class="uncovered1"><a name="line543"></a>543             @datetime = @datetime.change(:day =&gt; 1)
</span><span class="uncovered0"><a name="line544"></a>544           end
</span><span class="uncovered1"><a name="line545"></a>545 
</span><span class="uncovered0"><a name="line546"></a>546           [:day, :month, :year].each { |o| order.unshift(o) unless order.include?(o) }
</span><span class="uncovered1"><a name="line547"></a>547           order += [:hour, :minute, :second] unless @options[:discard_hour]
</span><span class="uncovered0"><a name="line548"></a>548 
</span><span class="uncovered1"><a name="line549"></a>549           build_selects_from_types(order)
</span><span class="uncovered0"><a name="line550"></a>550         else
</span><span class="uncovered1"><a name="line551"></a>551           &quot;#{select_date}#{@options[:datetime_separator]}#{select_time}&quot;
</span><span class="uncovered0"><a name="line552"></a>552         end
</span><span class="uncovered1"><a name="line553"></a>553       end
</span><span class="inferred0"><a name="line554"></a>554 
</span><span class="marked1"><a name="line555"></a>555       def select_date
</span><span class="uncovered0"><a name="line556"></a>556         order = date_order.dup
</span><span class="uncovered1"><a name="line557"></a>557 
</span><span class="uncovered0"><a name="line558"></a>558         # TODO: Remove tag conditional
</span><span class="uncovered1"><a name="line559"></a>559         if @options[:tag]
</span><span class="uncovered0"><a name="line560"></a>560           @options[:discard_hour]     = true
</span><span class="uncovered1"><a name="line561"></a>561           @options[:discard_minute]   = true
</span><span class="uncovered0"><a name="line562"></a>562           @options[:discard_second]   = true
</span><span class="uncovered1"><a name="line563"></a>563 
</span><span class="uncovered0"><a name="line564"></a>564           @options[:discard_year]   ||= true unless order.include?(:year)
</span><span class="uncovered1"><a name="line565"></a>565           @options[:discard_month]  ||= true unless order.include?(:month)
</span><span class="uncovered0"><a name="line566"></a>566           @options[:discard_day]    ||= true if @options[:discard_month] || !order.include?(:day)
</span><span class="uncovered1"><a name="line567"></a>567 
</span><span class="uncovered0"><a name="line568"></a>568           # If the day is hidden and the month is visible, the day should be set to the 1st so all month choices are
</span><span class="uncovered1"><a name="line569"></a>569           # valid (otherwise it could be 31 and february wouldn't be a valid date)
</span><span class="uncovered0"><a name="line570"></a>570           if @datetime &amp;&amp; @options[:discard_day] &amp;&amp; !@options[:discard_month]
</span><span class="uncovered1"><a name="line571"></a>571             @datetime = @datetime.change(:day =&gt; 1)
</span><span class="uncovered0"><a name="line572"></a>572           end
</span><span class="uncovered1"><a name="line573"></a>573         end
</span><span class="uncovered0"><a name="line574"></a>574 
</span><span class="uncovered1"><a name="line575"></a>575         [:day, :month, :year].each { |o| order.unshift(o) unless order.include?(o) }
</span><span class="uncovered0"><a name="line576"></a>576 
</span><span class="uncovered1"><a name="line577"></a>577         build_selects_from_types(order)
</span><span class="uncovered0"><a name="line578"></a>578       end
</span><span class="inferred1"><a name="line579"></a>579 
</span><span class="marked0"><a name="line580"></a>580       def select_time
</span><span class="uncovered1"><a name="line581"></a>581         order = []
</span><span class="uncovered0"><a name="line582"></a>582 
</span><span class="uncovered1"><a name="line583"></a>583         # TODO: Remove tag conditional
</span><span class="uncovered0"><a name="line584"></a>584         if @options[:tag]
</span><span class="uncovered1"><a name="line585"></a>585           @options[:discard_month]    = true
</span><span class="uncovered0"><a name="line586"></a>586           @options[:discard_year]     = true
</span><span class="uncovered1"><a name="line587"></a>587           @options[:discard_day]      = true
</span><span class="uncovered0"><a name="line588"></a>588           @options[:discard_second] ||= true unless @options[:include_seconds]
</span><span class="uncovered1"><a name="line589"></a>589 
</span><span class="uncovered0"><a name="line590"></a>590           order += [:year, :month, :day] unless @options[:ignore_date]
</span><span class="uncovered1"><a name="line591"></a>591         end
</span><span class="uncovered0"><a name="line592"></a>592 
</span><span class="uncovered1"><a name="line593"></a>593         order += [:hour, :minute]
</span><span class="uncovered0"><a name="line594"></a>594         order &lt;&lt; :second if @options[:include_seconds]
</span><span class="uncovered1"><a name="line595"></a>595 
</span><span class="uncovered0"><a name="line596"></a>596         build_selects_from_types(order)
</span><span class="uncovered1"><a name="line597"></a>597       end
</span><span class="inferred0"><a name="line598"></a>598 
</span><span class="marked1"><a name="line599"></a>599       def select_second
</span><span class="uncovered0"><a name="line600"></a>600         if @options[:use_hidden] || @options[:discard_second]
</span><span class="uncovered1"><a name="line601"></a>601           build_hidden(:second, sec) if @options[:include_seconds]
</span><span class="uncovered0"><a name="line602"></a>602         else
</span><span class="uncovered1"><a name="line603"></a>603           build_options_and_select(:second, sec)
</span><span class="uncovered0"><a name="line604"></a>604         end
</span><span class="uncovered1"><a name="line605"></a>605       end
</span><span class="inferred0"><a name="line606"></a>606 
</span><span class="marked1"><a name="line607"></a>607       def select_minute
</span><span class="uncovered0"><a name="line608"></a>608         if @options[:use_hidden] || @options[:discard_minute]
</span><span class="uncovered1"><a name="line609"></a>609           build_hidden(:minute, min)
</span><span class="uncovered0"><a name="line610"></a>610         else
</span><span class="uncovered1"><a name="line611"></a>611           build_options_and_select(:minute, min, :step =&gt; @options[:minute_step])
</span><span class="uncovered0"><a name="line612"></a>612         end
</span><span class="uncovered1"><a name="line613"></a>613       end
</span><span class="inferred0"><a name="line614"></a>614 
</span><span class="marked1"><a name="line615"></a>615       def select_hour
</span><span class="uncovered0"><a name="line616"></a>616         if @options[:use_hidden] || @options[:discard_hour]
</span><span class="uncovered1"><a name="line617"></a>617           build_hidden(:hour, hour)
</span><span class="uncovered0"><a name="line618"></a>618         else
</span><span class="uncovered1"><a name="line619"></a>619           build_options_and_select(:hour, hour, :end =&gt; 23)
</span><span class="uncovered0"><a name="line620"></a>620         end
</span><span class="uncovered1"><a name="line621"></a>621       end
</span><span class="inferred0"><a name="line622"></a>622 
</span><span class="marked1"><a name="line623"></a>623       def select_day
</span><span class="uncovered0"><a name="line624"></a>624         if @options[:use_hidden] || @options[:discard_day]
</span><span class="uncovered1"><a name="line625"></a>625           build_hidden(:day, day)
</span><span class="uncovered0"><a name="line626"></a>626         else
</span><span class="uncovered1"><a name="line627"></a>627           build_options_and_select(:day, day, :start =&gt; 1, :end =&gt; 31, :leading_zeros =&gt; false)
</span><span class="uncovered0"><a name="line628"></a>628         end
</span><span class="uncovered1"><a name="line629"></a>629       end
</span><span class="inferred0"><a name="line630"></a>630 
</span><span class="marked1"><a name="line631"></a>631       def select_month
</span><span class="uncovered0"><a name="line632"></a>632         if @options[:use_hidden] || @options[:discard_month]
</span><span class="uncovered1"><a name="line633"></a>633           build_hidden(:month, month)
</span><span class="uncovered0"><a name="line634"></a>634         else
</span><span class="uncovered1"><a name="line635"></a>635           month_options = []
</span><span class="uncovered0"><a name="line636"></a>636           1.upto(12) do |month_number|
</span><span class="uncovered1"><a name="line637"></a>637             options = { :value =&gt; month_number }
</span><span class="uncovered0"><a name="line638"></a>638             options[:selected] = &quot;selected&quot; if month == month_number
</span><span class="uncovered1"><a name="line639"></a>639             month_options &lt;&lt; content_tag(:option, month_name(month_number), options) + &quot;\n&quot;
</span><span class="uncovered0"><a name="line640"></a>640           end
</span><span class="uncovered1"><a name="line641"></a>641           build_select(:month, month_options.join)
</span><span class="uncovered0"><a name="line642"></a>642         end
</span><span class="uncovered1"><a name="line643"></a>643       end
</span><span class="inferred0"><a name="line644"></a>644 
</span><span class="marked1"><a name="line645"></a>645       def select_year
</span><span class="uncovered0"><a name="line646"></a>646         if !@datetime || @datetime == 0
</span><span class="uncovered1"><a name="line647"></a>647           val = ''
</span><span class="uncovered0"><a name="line648"></a>648           middle_year = Date.today.year
</span><span class="uncovered1"><a name="line649"></a>649         else
</span><span class="uncovered0"><a name="line650"></a>650           val = middle_year = year
</span><span class="uncovered1"><a name="line651"></a>651         end
</span><span class="uncovered0"><a name="line652"></a>652 
</span><span class="uncovered1"><a name="line653"></a>653         if @options[:use_hidden] || @options[:discard_year]
</span><span class="uncovered0"><a name="line654"></a>654           build_hidden(:year, val)
</span><span class="uncovered1"><a name="line655"></a>655         else
</span><span class="uncovered0"><a name="line656"></a>656           options                 = {}
</span><span class="uncovered1"><a name="line657"></a>657           options[:start]         = @options[:start_year] || middle_year - 5
</span><span class="uncovered0"><a name="line658"></a>658           options[:end]           = @options[:end_year] || middle_year + 5
</span><span class="uncovered1"><a name="line659"></a>659           options[:step]          = options[:start] &lt; options[:end] ? 1 : -1
</span><span class="uncovered0"><a name="line660"></a>660           options[:leading_zeros] = false
</span><span class="uncovered1"><a name="line661"></a>661 
</span><span class="uncovered0"><a name="line662"></a>662           build_options_and_select(:year, val, options)
</span><span class="uncovered1"><a name="line663"></a>663         end
</span><span class="uncovered0"><a name="line664"></a>664       end
</span><span class="inferred1"><a name="line665"></a>665 
</span><span class="marked0"><a name="line666"></a>666       private
</span><span class="marked1"><a name="line667"></a>667         %w( sec min hour day month year ).each do |method|
</span><span class="marked0"><a name="line668"></a>668           define_method(method) do
</span><span class="inferred1"><a name="line669"></a>669             @datetime.kind_of?(Fixnum) ? @datetime : @datetime.send(method) if @datetime
</span><span class="inferred0"><a name="line670"></a>670           end
</span><span class="inferred1"><a name="line671"></a>671         end
</span><span class="inferred0"><a name="line672"></a>672 
</span><span class="inferred1"><a name="line673"></a>673         # Returns translated month names, but also ensures that a custom month
</span><span class="inferred0"><a name="line674"></a>674         # name array has a leading nil element
</span><span class="marked1"><a name="line675"></a>675         def month_names
</span><span class="inferred0"><a name="line676"></a>676           month_names = @options[:use_month_names] || translated_month_names
</span><span class="inferred1"><a name="line677"></a>677           month_names.unshift(nil) if month_names.size &lt; 13
</span><span class="inferred0"><a name="line678"></a>678           month_names
</span><span class="inferred1"><a name="line679"></a>679         end
</span><span class="marked0"><a name="line680"></a>680         memoize :month_names
</span><span class="inferred1"><a name="line681"></a>681 
</span><span class="inferred0"><a name="line682"></a>682         # Returns translated month names
</span><span class="inferred1"><a name="line683"></a>683         #  =&gt; [nil, &quot;January&quot;, &quot;February&quot;, &quot;March&quot;,
</span><span class="inferred0"><a name="line684"></a>684         #           &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;,
</span><span class="inferred1"><a name="line685"></a>685         #           &quot;August&quot;, &quot;September&quot;, &quot;October&quot;,
</span><span class="inferred0"><a name="line686"></a>686         #           &quot;November&quot;, &quot;December&quot;]
</span><span class="inferred1"><a name="line687"></a>687         #
</span><span class="inferred0"><a name="line688"></a>688         # If :use_short_month option is set
</span><span class="inferred1"><a name="line689"></a>689         #  =&gt; [nil, &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;,
</span><span class="inferred0"><a name="line690"></a>690         #           &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;]
</span><span class="marked1"><a name="line691"></a>691         def translated_month_names
</span><span class="inferred0"><a name="line692"></a>692           begin
</span><span class="inferred1"><a name="line693"></a>693             key = @options[:use_short_month] ? :'date.abbr_month_names' : :'date.month_names'
</span><span class="inferred0"><a name="line694"></a>694             I18n.translate(key, :locale =&gt; @options[:locale])
</span><span class="inferred1"><a name="line695"></a>695           end
</span><span class="inferred0"><a name="line696"></a>696         end
</span><span class="inferred1"><a name="line697"></a>697 
</span><span class="inferred0"><a name="line698"></a>698         # Lookup month name for number
</span><span class="inferred1"><a name="line699"></a>699         #  month_name(1) =&gt; &quot;January&quot;
</span><span class="inferred0"><a name="line700"></a>700         #
</span><span class="inferred1"><a name="line701"></a>701         # If :use_month_numbers option is passed
</span><span class="inferred0"><a name="line702"></a>702         #  month_name(1) =&gt; 1
</span><span class="inferred1"><a name="line703"></a>703         #
</span><span class="inferred0"><a name="line704"></a>704         # If :add_month_numbers option is passed
</span><span class="inferred1"><a name="line705"></a>705         #  month_name(1) =&gt; &quot;1 - January&quot;
</span><span class="marked0"><a name="line706"></a>706         def month_name(number)
</span><span class="inferred1"><a name="line707"></a>707           if @options[:use_month_numbers]
</span><span class="inferred0"><a name="line708"></a>708             number
</span><span class="inferred1"><a name="line709"></a>709           elsif @options[:add_month_numbers]
</span><span class="inferred0"><a name="line710"></a>710             &quot;#{number} - #{month_names[number]}&quot;
</span><span class="inferred1"><a name="line711"></a>711           else
</span><span class="inferred0"><a name="line712"></a>712             month_names[number]
</span><span class="inferred1"><a name="line713"></a>713           end
</span><span class="inferred0"><a name="line714"></a>714         end
</span><span class="inferred1"><a name="line715"></a>715 
</span><span class="marked0"><a name="line716"></a>716         def date_order
</span><span class="inferred1"><a name="line717"></a>717           @options[:order] || translated_date_order
</span><span class="inferred0"><a name="line718"></a>718         end
</span><span class="marked1"><a name="line719"></a>719         memoize :date_order
</span><span class="inferred0"><a name="line720"></a>720 
</span><span class="marked1"><a name="line721"></a>721         def translated_date_order
</span><span class="inferred0"><a name="line722"></a>722           begin
</span><span class="inferred1"><a name="line723"></a>723             I18n.translate(:'date.order', :locale =&gt; @options[:locale]) || []
</span><span class="inferred0"><a name="line724"></a>724           end
</span><span class="inferred1"><a name="line725"></a>725         end
</span><span class="inferred0"><a name="line726"></a>726 
</span><span class="inferred1"><a name="line727"></a>727         # Build full select tag from date type and options
</span><span class="marked0"><a name="line728"></a>728         def build_options_and_select(type, selected, options = {})
</span><span class="inferred1"><a name="line729"></a>729           build_select(type, build_options(selected, options))
</span><span class="inferred0"><a name="line730"></a>730         end
</span><span class="inferred1"><a name="line731"></a>731 
</span><span class="inferred0"><a name="line732"></a>732         # Build select option html from date value and options
</span><span class="inferred1"><a name="line733"></a>733         #  build_options(15, :start =&gt; 1, :end =&gt; 31)
</span><span class="inferred0"><a name="line734"></a>734         #  =&gt; &quot;&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;
</span><span class="inferred1"><a name="line735"></a>735         #      &lt;option value=\&quot;2\&quot;&gt;2&lt;/option&gt;
</span><span class="inferred0"><a name="line736"></a>736         #      &lt;option value=\&quot;3\&quot;&gt;3&lt;/option&gt;...&quot;
</span><span class="marked1"><a name="line737"></a>737         def build_options(selected, options = {})
</span><span class="inferred0"><a name="line738"></a>738           start         = options.delete(:start) || 0
</span><span class="inferred1"><a name="line739"></a>739           stop          = options.delete(:end) || 59
</span><span class="inferred0"><a name="line740"></a>740           step          = options.delete(:step) || 1
</span><span class="inferred1"><a name="line741"></a>741           leading_zeros = options.delete(:leading_zeros).nil? ? true : false
</span><span class="inferred0"><a name="line742"></a>742 
</span><span class="inferred1"><a name="line743"></a>743           select_options = []
</span><span class="inferred0"><a name="line744"></a>744           start.step(stop, step) do |i|
</span><span class="inferred1"><a name="line745"></a>745             value = leading_zeros ? sprintf(&quot;%02d&quot;, i) : i
</span><span class="inferred0"><a name="line746"></a>746             tag_options = { :value =&gt; value }
</span><span class="inferred1"><a name="line747"></a>747             tag_options[:selected] = &quot;selected&quot; if selected == i
</span><span class="inferred0"><a name="line748"></a>748             select_options &lt;&lt; content_tag(:option, value, tag_options)
</span><span class="inferred1"><a name="line749"></a>749           end
</span><span class="inferred0"><a name="line750"></a>750           select_options.join(&quot;\n&quot;) + &quot;\n&quot;
</span><span class="inferred1"><a name="line751"></a>751         end
</span><span class="inferred0"><a name="line752"></a>752 
</span><span class="inferred1"><a name="line753"></a>753         # Builds select tag from date type and html select options
</span><span class="inferred0"><a name="line754"></a>754         #  build_select(:month, &quot;&lt;option value=&quot;1&quot;&gt;January&lt;/option&gt;...&quot;)
</span><span class="inferred1"><a name="line755"></a>755         #  =&gt; &quot;&lt;select id=&quot;post_written_on_2i&quot; name=&quot;post[written_on(2i)]&quot;&gt;
</span><span class="inferred0"><a name="line756"></a>756         #        &lt;option value=&quot;1&quot;&gt;January&lt;/option&gt;...
</span><span class="inferred1"><a name="line757"></a>757         #      &lt;/select&gt;&quot;
</span><span class="marked0"><a name="line758"></a>758         def build_select(type, select_options_as_html)
</span><span class="uncovered1"><a name="line759"></a>759           select_options = {
</span><span class="uncovered0"><a name="line760"></a>760             :id =&gt; input_id_from_type(type),
</span><span class="uncovered1"><a name="line761"></a>761             :name =&gt; input_name_from_type(type)
</span><span class="uncovered0"><a name="line762"></a>762           }.merge(@html_options)
</span><span class="uncovered1"><a name="line763"></a>763           select_options.merge!(:disabled =&gt; 'disabled') if @options[:disabled]
</span><span class="uncovered0"><a name="line764"></a>764 
</span><span class="uncovered1"><a name="line765"></a>765           select_html = &quot;\n&quot;
</span><span class="uncovered0"><a name="line766"></a>766           select_html &lt;&lt; content_tag(:option, '', :value =&gt; '') + &quot;\n&quot; if @options[:include_blank]
</span><span class="uncovered1"><a name="line767"></a>767           select_html &lt;&lt; select_options_as_html.to_s
</span><span class="uncovered0"><a name="line768"></a>768 
</span><span class="uncovered1"><a name="line769"></a>769           content_tag(:select, select_html, select_options) + &quot;\n&quot;
</span><span class="uncovered0"><a name="line770"></a>770         end
</span><span class="inferred1"><a name="line771"></a>771 
</span><span class="inferred0"><a name="line772"></a>772         # Builds hidden input tag for date part and value
</span><span class="inferred1"><a name="line773"></a>773         #  build_hidden(:year, 2008)
</span><span class="inferred0"><a name="line774"></a>774         #  =&gt; &quot;&lt;input id=&quot;post_written_on_1i&quot; name=&quot;post[written_on(1i)]&quot; type=&quot;hidden&quot; value=&quot;2008&quot; /&gt;&quot;
</span><span class="marked1"><a name="line775"></a>775         def build_hidden(type, value)
</span><span class="uncovered0"><a name="line776"></a>776           tag(:input, {
</span><span class="uncovered1"><a name="line777"></a>777             :type =&gt; &quot;hidden&quot;,
</span><span class="uncovered0"><a name="line778"></a>778             :id =&gt; input_id_from_type(type),
</span><span class="uncovered1"><a name="line779"></a>779             :name =&gt; input_name_from_type(type),
</span><span class="uncovered0"><a name="line780"></a>780             :value =&gt; value
</span><span class="uncovered1"><a name="line781"></a>781           }) + &quot;\n&quot;
</span><span class="uncovered0"><a name="line782"></a>782         end
</span><span class="inferred1"><a name="line783"></a>783 
</span><span class="inferred0"><a name="line784"></a>784         # Returns the name attribute for the input tag
</span><span class="inferred1"><a name="line785"></a>785         #  =&gt; post[written_on(1i)]
</span><span class="marked0"><a name="line786"></a>786         def input_name_from_type(type)
</span><span class="uncovered1"><a name="line787"></a>787           prefix = @options[:prefix] || ActionView::Helpers::DateTimeSelector::DEFAULT_PREFIX
</span><span class="uncovered0"><a name="line788"></a>788           prefix += &quot;[#{@options[:index]}]&quot; if @options[:index]
</span><span class="uncovered1"><a name="line789"></a>789 
</span><span class="uncovered0"><a name="line790"></a>790           field_name = @options[:field_name] || type
</span><span class="uncovered1"><a name="line791"></a>791           if @options[:include_position]
</span><span class="uncovered0"><a name="line792"></a>792             field_name += &quot;(#{ActionView::Helpers::DateTimeSelector::POSITION[type]}i)&quot;
</span><span class="uncovered1"><a name="line793"></a>793           end
</span><span class="uncovered0"><a name="line794"></a>794 
</span><span class="uncovered1"><a name="line795"></a>795           @options[:discard_type] ? prefix : &quot;#{prefix}[#{field_name}]&quot;
</span><span class="uncovered0"><a name="line796"></a>796         end
</span><span class="inferred1"><a name="line797"></a>797 
</span><span class="inferred0"><a name="line798"></a>798         # Returns the id attribute for the input tag
</span><span class="inferred1"><a name="line799"></a>799         #  =&gt; &quot;post_written_on_1i&quot;
</span><span class="marked0"><a name="line800"></a>800         def input_id_from_type(type)
</span><span class="uncovered1"><a name="line801"></a>801           input_name_from_type(type).gsub(/([\[\(])|(\]\[)/, '_').gsub(/[\]\)]/, '')
</span><span class="uncovered0"><a name="line802"></a>802         end
</span><span class="inferred1"><a name="line803"></a>803 
</span><span class="inferred0"><a name="line804"></a>804         # Given an ordering of datetime components, create the selection html
</span><span class="inferred1"><a name="line805"></a>805         # and join them with their appropriate seperators
</span><span class="marked0"><a name="line806"></a>806         def build_selects_from_types(order)
</span><span class="uncovered1"><a name="line807"></a>807           select = ''
</span><span class="uncovered0"><a name="line808"></a>808           order.reverse.each do |type|
</span><span class="uncovered1"><a name="line809"></a>809             separator = separator(type) unless type == order.first # don't add on last field
</span><span class="uncovered0"><a name="line810"></a>810             select.insert(0, separator.to_s + send(&quot;select_#{type}&quot;).to_s)
</span><span class="uncovered1"><a name="line811"></a>811           end
</span><span class="uncovered0"><a name="line812"></a>812           select
</span><span class="uncovered1"><a name="line813"></a>813         end
</span><span class="inferred0"><a name="line814"></a>814 
</span><span class="inferred1"><a name="line815"></a>815         # Returns the separator for a given datetime component
</span><span class="marked0"><a name="line816"></a>816         def separator(type)
</span><span class="uncovered1"><a name="line817"></a>817           case type
</span><span class="uncovered0"><a name="line818"></a>818             when :month, :day
</span><span class="uncovered1"><a name="line819"></a>819               @options[:date_separator]
</span><span class="uncovered0"><a name="line820"></a>820             when :hour
</span><span class="uncovered1"><a name="line821"></a>821               (@options[:discard_year] &amp;&amp; @options[:discard_day]) ? &quot;&quot; : @options[:datetime_separator]
</span><span class="uncovered0"><a name="line822"></a>822             when :minute
</span><span class="uncovered1"><a name="line823"></a>823               @options[:time_separator]
</span><span class="uncovered0"><a name="line824"></a>824             when :second
</span><span class="uncovered1"><a name="line825"></a>825               @options[:include_seconds] ? @options[:time_separator] : &quot;&quot;
</span><span class="uncovered0"><a name="line826"></a>826           end
</span><span class="uncovered1"><a name="line827"></a>827         end
</span><span class="uncovered0"><a name="line828"></a>828     end
</span><span class="inferred1"><a name="line829"></a>829 
</span><span class="marked0"><a name="line830"></a>830     class InstanceTag #:nodoc:
</span><span class="marked1"><a name="line831"></a>831       def to_date_select_tag(options = {}, html_options = {})
</span><span class="uncovered0"><a name="line832"></a>832         datetime_selector(options, html_options).select_date
</span><span class="uncovered1"><a name="line833"></a>833       end
</span><span class="inferred0"><a name="line834"></a>834 
</span><span class="marked1"><a name="line835"></a>835       def to_time_select_tag(options = {}, html_options = {})
</span><span class="uncovered0"><a name="line836"></a>836         datetime_selector(options, html_options).select_time
</span><span class="uncovered1"><a name="line837"></a>837       end
</span><span class="inferred0"><a name="line838"></a>838 
</span><span class="marked1"><a name="line839"></a>839       def to_datetime_select_tag(options = {}, html_options = {})
</span><span class="uncovered0"><a name="line840"></a>840         datetime_selector(options, html_options).select_datetime
</span><span class="uncovered1"><a name="line841"></a>841       end
</span><span class="inferred0"><a name="line842"></a>842 
</span><span class="marked1"><a name="line843"></a>843       private
</span><span class="marked0"><a name="line844"></a>844         def datetime_selector(options, html_options)
</span><span class="uncovered1"><a name="line845"></a>845           datetime = value(object) || default_datetime(options)
</span><span class="uncovered0"><a name="line846"></a>846 
</span><span class="uncovered1"><a name="line847"></a>847           options = options.dup
</span><span class="uncovered0"><a name="line848"></a>848           options[:field_name]           = @method_name
</span><span class="uncovered1"><a name="line849"></a>849           options[:include_position]     = true
</span><span class="uncovered0"><a name="line850"></a>850           options[:prefix]             ||= @object_name
</span><span class="uncovered1"><a name="line851"></a>851           options[:index]              ||= @auto_index
</span><span class="uncovered0"><a name="line852"></a>852           options[:datetime_separator] ||= ' &amp;mdash; '
</span><span class="uncovered1"><a name="line853"></a>853           options[:time_separator]     ||= ' : '
</span><span class="uncovered0"><a name="line854"></a>854 
</span><span class="uncovered1"><a name="line855"></a>855           DateTimeSelector.new(datetime, options.merge(:tag =&gt; true), html_options)
</span><span class="uncovered0"><a name="line856"></a>856         end
</span><span class="inferred1"><a name="line857"></a>857 
</span><span class="marked0"><a name="line858"></a>858         def default_datetime(options)
</span><span class="uncovered1"><a name="line859"></a>859           return if options[:include_blank]
</span><span class="uncovered0"><a name="line860"></a>860 
</span><span class="uncovered1"><a name="line861"></a>861           case options[:default]
</span><span class="uncovered0"><a name="line862"></a>862             when nil
</span><span class="uncovered1"><a name="line863"></a>863               Time.current
</span><span class="uncovered0"><a name="line864"></a>864             when Date, Time
</span><span class="uncovered1"><a name="line865"></a>865               options[:default]
</span><span class="uncovered0"><a name="line866"></a>866             else
</span><span class="uncovered1"><a name="line867"></a>867               default = options[:default].dup
</span><span class="uncovered0"><a name="line868"></a>868 
</span><span class="uncovered1"><a name="line869"></a>869               # Rename :minute and :second to :min and :sec
</span><span class="uncovered0"><a name="line870"></a>870               default[:min] ||= default[:minute]
</span><span class="uncovered1"><a name="line871"></a>871               default[:sec] ||= default[:second]
</span><span class="uncovered0"><a name="line872"></a>872 
</span><span class="uncovered1"><a name="line873"></a>873               time = Time.current
</span><span class="uncovered0"><a name="line874"></a>874 
</span><span class="uncovered1"><a name="line875"></a>875               [:year, :month, :day, :hour, :min, :sec].each do |key|
</span><span class="uncovered0"><a name="line876"></a>876                 default[key] ||= time.send(key)
</span><span class="uncovered1"><a name="line877"></a>877               end
</span><span class="uncovered0"><a name="line878"></a>878 
</span><span class="uncovered1"><a name="line879"></a>879               Time.utc_time(
</span><span class="uncovered0"><a name="line880"></a>880                 default[:year], default[:month], default[:day],
</span><span class="uncovered1"><a name="line881"></a>881                 default[:hour], default[:min], default[:sec]
</span><span class="uncovered0"><a name="line882"></a>882               )
</span><span class="uncovered1"><a name="line883"></a>883           end
</span><span class="uncovered0"><a name="line884"></a>884         end
</span><span class="uncovered1"><a name="line885"></a>885     end
</span><span class="inferred0"><a name="line886"></a>886 
</span><span class="marked1"><a name="line887"></a>887     class FormBuilder
</span><span class="marked0"><a name="line888"></a>888       def date_select(method, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line889"></a>889         @template.date_select(@object_name, method, options.merge(:object =&gt; @object), html_options)
</span><span class="uncovered0"><a name="line890"></a>890       end
</span><span class="inferred1"><a name="line891"></a>891 
</span><span class="marked0"><a name="line892"></a>892       def time_select(method, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line893"></a>893         @template.time_select(@object_name, method, options.merge(:object =&gt; @object), html_options)
</span><span class="uncovered0"><a name="line894"></a>894       end
</span><span class="inferred1"><a name="line895"></a>895 
</span><span class="marked0"><a name="line896"></a>896       def datetime_select(method, options = {}, html_options = {})
</span><span class="uncovered1"><a name="line897"></a>897         @template.datetime_select(@object_name, method, options.merge(:object =&gt; @object), html_options)
</span><span class="uncovered0"><a name="line898"></a>898       end
</span><span class="uncovered1"><a name="line899"></a>899     end
</span><span class="uncovered0"><a name="line900"></a>900   end
</span><span class="uncovered1"><a name="line901"></a>901 end
</span></pre><hr/>
    <p>Generated using the <a href='http://eigenclass.org/hiki.rb?rcov'>rcov code coverage analysis tool for Ruby</a>
   version 0.8.1.2.</p>
<p><a href='http://validator.w3.org/check/referer'><img src='http://www.w3.org/Icons/valid-xhtml10' height='31' alt='Valid XHTML 1.0!' width='88'/>
        </a>
      <a href='http://jigsaw.w3.org/css-validator/check/referer'><img src='http://jigsaw.w3.org/css-validator/images/vcss' alt='Valid CSS!' style='border:0;width:88px;height:31px'/>
        </a>
      </p>
    </body>
  </html>
